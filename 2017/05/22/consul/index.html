

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta name="author" content="orctom">
    
    <meta name="description" content="InstallationDownload package from https://www.consul.io/downloads.html, and unzip to ~/bin or /usr/local/bin.12curl https://releases.hashicorp.com/con">
    
    

    
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Consul | orctom</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Javascript -->
    <script src="/js/jquery-2.1.0.min.js"></script>
    <script src="/js/jquery.backstretch.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/headroom.min.js"></script>
    <script src="/js/jquery.headroom.min.js"></script> 
    <script src="/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/" title="orctom">orctom</a>
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                

                <ul class="nav navbar-nav">
                    
                    
                    
                </ul>
            </div>
        </div>
    </nav>
    
    <script>
    $(function() {
        // page-id...
        var pageId = "2017/05/22/consul/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";
        
        $("#nav-" + pageId).addClass("active");
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>Consul</h1>
        
        <div class="time-info">
<time datetime="2017-05-22T15:18:36.000Z" itemprop="datePublished">May 22, 2017</time> (updated: <time datetime="2017-05-24T14:13:14.000Z" itemprop="dateModified">May 24, 2017</time>)
        </div>
        
        <div class="post-body-inner">
            <div id="toc" class="toc-article well">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation"><span class="toc-number">1.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run"><span class="toc-number">2.</span> <span class="toc-text">Run</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dev-Mode"><span class="toc-number">2.1.</span> <span class="toc-text">Dev Mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#With-UI"><span class="toc-number">2.2.</span> <span class="toc-text">With UI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#More-Options"><span class="toc-number">2.3.</span> <span class="toc-text">More Options</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker"><span class="toc-number">2.4.</span> <span class="toc-text">Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashi-ui"><span class="toc-number">2.5.</span> <span class="toc-text">hashi-ui</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Used-Ports"><span class="toc-number">3.</span> <span class="toc-text">Used Ports</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cluster"><span class="toc-number">4.</span> <span class="toc-text">Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Server"><span class="toc-number">4.1.</span> <span class="toc-text">Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client"><span class="toc-number">4.2.</span> <span class="toc-text">Client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Health-Checks"><span class="toc-number">5.</span> <span class="toc-text">Health Checks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Script-Interval"><span class="toc-number">5.1.</span> <span class="toc-text">Script + Interval</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-Interval"><span class="toc-number">5.2.</span> <span class="toc-text">HTTP + Interval</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-Interval"><span class="toc-number">5.3.</span> <span class="toc-text">TCP + Interval</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TTL"><span class="toc-number">5.4.</span> <span class="toc-text">TTL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Interval"><span class="toc-number">5.5.</span> <span class="toc-text">Docker + Interval</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Watches"><span class="toc-number">6.</span> <span class="toc-text">Watches</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#key"><span class="toc-number">6.1.</span> <span class="toc-text">key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keyprefix"><span class="toc-number">6.2.</span> <span class="toc-text">keyprefix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#services"><span class="toc-number">6.3.</span> <span class="toc-text">services</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodes"><span class="toc-number">6.4.</span> <span class="toc-text">nodes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service"><span class="toc-number">6.5.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#checks"><span class="toc-number">6.6.</span> <span class="toc-text">checks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#event"><span class="toc-number">6.7.</span> <span class="toc-text">event</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-API"><span class="toc-number">7.</span> <span class="toc-text">HTTP API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACLs"><span class="toc-number">7.1.</span> <span class="toc-text">ACLs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-ACL-Token"><span class="toc-number">7.1.1.</span> <span class="toc-text">Create ACL Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Update-ACL-Token"><span class="toc-number">7.1.2.</span> <span class="toc-text">Update ACL Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Delete-ACL-Token"><span class="toc-number">7.1.3.</span> <span class="toc-text">Delete ACL Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-ACL-Token"><span class="toc-number">7.1.4.</span> <span class="toc-text">Read ACL Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Clone-ACL-Token"><span class="toc-number">7.1.5.</span> <span class="toc-text">Clone ACL Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List-ACLs"><span class="toc-number">7.1.6.</span> <span class="toc-text">List ACLs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Agent"><span class="toc-number">7.2.</span> <span class="toc-text">Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Members"><span class="toc-number">7.2.1.</span> <span class="toc-text">List Members</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-Conf"><span class="toc-number">7.2.2.</span> <span class="toc-text">Read Conf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reload"><span class="toc-number">7.2.3.</span> <span class="toc-text">Reload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-Maintenance-Mode"><span class="toc-number">7.2.4.</span> <span class="toc-text">Enable Maintenance Mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stream-Logs"><span class="toc-number">7.2.5.</span> <span class="toc-text">Stream Logs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Join-Agent"><span class="toc-number">7.2.6.</span> <span class="toc-text">Join Agent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Graceful-Leave"><span class="toc-number">7.2.7.</span> <span class="toc-text">Graceful Leave</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Force-Leave"><span class="toc-number">7.2.8.</span> <span class="toc-text">Force Leave</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check"><span class="toc-number">7.3.</span> <span class="toc-text">Check</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Checks"><span class="toc-number">7.3.1.</span> <span class="toc-text">List Checks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Register-Check"><span class="toc-number">7.3.2.</span> <span class="toc-text">Register Check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Deregister-Check"><span class="toc-number">7.3.3.</span> <span class="toc-text">Deregister Check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TTL-Check-Pass"><span class="toc-number">7.3.4.</span> <span class="toc-text">TTL Check Pass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TTL-Check-Warn"><span class="toc-number">7.3.5.</span> <span class="toc-text">TTL Check Warn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TTL-Check-Fail"><span class="toc-number">7.3.6.</span> <span class="toc-text">TTL Check Fail</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-number">7.4.</span> <span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Services"><span class="toc-number">7.4.1.</span> <span class="toc-text">List Services</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Register-Service"><span class="toc-number">7.5.</span> <span class="toc-text">Register Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Deregister-Service"><span class="toc-number">7.5.1.</span> <span class="toc-text">Deregister Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-Maintenance-Mode-1"><span class="toc-number">7.5.2.</span> <span class="toc-text">Enable Maintenance Mode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Catelog"><span class="toc-number">7.6.</span> <span class="toc-text">Catelog</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#List-DataCenters"><span class="toc-number">7.6.1.</span> <span class="toc-text">List DataCenters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Services-1"><span class="toc-number">7.6.2.</span> <span class="toc-text">List Services</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Nodes-for-Service"><span class="toc-number">7.6.3.</span> <span class="toc-text">List Nodes for Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List-Services-for-Node"><span class="toc-number">7.6.4.</span> <span class="toc-text">List Services for Node</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Health"><span class="toc-number">7.7.</span> <span class="toc-text">Health</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Critical-Service"><span class="toc-number">7.7.1.</span> <span class="toc-text">Critical Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Passing-Service"><span class="toc-number">7.7.2.</span> <span class="toc-text">Passing Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Warning-Service"><span class="toc-number">7.7.3.</span> <span class="toc-text">Warning Service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KV-Store"><span class="toc-number">7.8.</span> <span class="toc-text">KV Store</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get"><span class="toc-number">7.8.1.</span> <span class="toc-text">Get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-Update-Key"><span class="toc-number">7.8.2.</span> <span class="toc-text">Create/Update Key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Delete-Key"><span class="toc-number">7.8.3.</span> <span class="toc-text">Delete Key</span></a></li></ol></li></ol></li></ol>
            </div>
            
            <h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Download package from <a href="https://www.consul.io/downloads.html" target="_blank" rel="external">https://www.consul.io/downloads.html</a>, and unzip to ~/bin or /usr/local/bin.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">https:</span><span class="comment">//releases.hashicorp.com/consul/0.8.3/consul_0.8.3_linux_amd64.zip -o /tmp/consul.zip;</span></div><div class="line">unzip <span class="regexp">/tmp/</span>consul.zip -d <span class="regexp">/usr/</span>local/bin</div></pre></td></tr></table></figure></p>
<h2 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h2><p><a href="https://www.consul.io/docs/agent/options.html" target="_blank" rel="external">Options for consul agent</a></p>
<h3 id="Dev-Mode"><a href="#Dev-Mode" class="headerlink" title="Dev Mode"></a>Dev Mode</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">consul agent -dev</span></div></pre></td></tr></table></figure>
<h3 id="With-UI"><a href="#With-UI" class="headerlink" title="With UI"></a>With UI</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">consul agent -dev -ui</span></div></pre></td></tr></table></figure>
<h3 id="More-Options"><a href="#More-Options" class="headerlink" title="More Options"></a>More Options</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">bootstrap-expect=<span class="number">3</span> \           <span class="comment">## Consul waits until the specified number of servers are available and then bootstraps the cluster</span></span></div><div class="line">  -<span class="ruby">bind=<span class="number">10.0</span>.<span class="number">20.1</span> \               <span class="comment">## If you have multi local IPs, choose one manually. Otherwize it will fail</span></span></div><div class="line">  -<span class="ruby">client=<span class="number">10.0</span>.<span class="number">20.1</span> \             <span class="comment">## Don't set it, unless you expects the HTTP, DNS and RPC servers be exposed to non-127.0.0.1</span></span></div><div class="line">  -<span class="ruby">config-dir=<span class="regexp">/etc/consul</span>.d/ \    <span class="comment">## A directory of configuration files (.json) to load</span></span></div><div class="line">  -<span class="ruby">data-dir=~<span class="regexp">/usr/local</span><span class="regexp">/consul/</span> \ <span class="comment">## Persistent state, the directory must be durable across reboots</span></span></div><div class="line">  -<span class="ruby">datacenter=uat \               <span class="comment">## Default: `dc1`. Nodes in the same datacenter should be on a single LAN</span></span></div><div class="line">  -<span class="ruby">encrypt=&lt;<span class="string">`consul keygen`</span>&gt; \    <span class="comment">## All nodes in the cluster share the same key, used for messages between agents</span></span></div><div class="line">  -<span class="ruby">node=node_name \               <span class="comment">## Default: `$hostname`, must be unique within the cluster</span></span></div><div class="line">  -<span class="ruby">server \                       <span class="comment">## Server mode, otherwise client mode</span></span></div><div class="line">  -<span class="ruby">ui                             <span class="comment">## Enable the default dashboard on http://localhost:8500/ui</span></span></div></pre></td></tr></table></figure>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>Dev Mode:<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker run -d \</div><div class="line">  -<span class="ruby">-name consul \</span></div><div class="line">  -<span class="ruby">p <span class="number">8300</span><span class="symbol">:</span><span class="number">8300</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8400</span><span class="symbol">:</span><span class="number">8400</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8500</span><span class="symbol">:</span><span class="number">8500</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8600</span><span class="symbol">:</span><span class="number">8600</span> \</span></div><div class="line">  consul</div></pre></td></tr></table></figure></p>
<h3 id="hashi-ui"><a href="#hashi-ui" class="headerlink" title="hashi-ui"></a>hashi-ui</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">docker run -d \</div><div class="line">  -<span class="ruby">-name=hashi-ui \</span></div><div class="line">  -<span class="ruby">e CONSUL_ENABLE=<span class="number">1</span> \</span></div><div class="line">  -<span class="ruby">e CONSUL_ADDR=&lt;ip&gt;<span class="symbol">:&lt;port&gt;</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">3000</span><span class="symbol">:</span><span class="number">3000</span> \</span></div><div class="line">  jippi/hashi-ui</div></pre></td></tr></table></figure>
<h2 id="Used-Ports"><a href="#Used-Ports" class="headerlink" title="Used Ports"></a>Used Ports</h2><ul>
<li>8300: server RPC, TCP only, handle RPC from other agents</li>
<li>8301: gossip in LAN, TCP and UDP, required</li>
<li>8302: gossip over WAN, TCP and UDP</li>
<li>8400: cli RPC, TCP only, handle RPC from cli</li>
<li>8500: HTTP API, UI, TCP only</li>
<li>8600: DNS Interface, TCP and UDP, handle DNS queries</li>
</ul>
<h2 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h2><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>3 or 5 server recommended. Start the Consul server with the following command on 3 or 5 servers.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">server \</span></div><div class="line">  -<span class="ruby">bootstrap-expect=<span class="number">3</span> \</span></div><div class="line">  -<span class="ruby">data-dir=<span class="regexp">/tmp/consul</span> \</span></div><div class="line">  -<span class="ruby">bind=&lt;ip&gt; \</span></div><div class="line">  -<span class="ruby">start_join=&lt;server1&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>Start the Consul client on every server that is part of the cluster with the following command.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">data-dir=<span class="regexp">/tmp/consul</span> \</span></div><div class="line">  -<span class="ruby">bind=&lt;ip&gt; \</span></div><div class="line">  -<span class="ruby">start_join=&lt;server1,server2,server3&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="Health-Checks"><a href="#Health-Checks" class="headerlink" title="Health Checks"></a>Health Checks</h2><h3 id="Script-Interval"><a href="#Script-Interval" class="headerlink" title="Script + Interval"></a>Script + Interval</h3><p>Exit code of <code>0</code> will be treated as passing.<br>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"curl localhost &gt;/dev/null 2&gt;&amp;1"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"mem-util"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="HTTP-Interval"><a href="#HTTP-Interval" class="headerlink" title="HTTP + Interval"></a>HTTP + Interval</h3><p>Based on the http response code:</p>
<ul>
<li>2xx: passing</li>
<li>429 (Too Many Requests): warning</li>
<li>others: failure</li>
</ul>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"api"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"HTTP API on port 5000"</span>,</div><div class="line">    <span class="attr">"http"</span>: <span class="string">"http://localhost:5000/health"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="TCP-Interval"><a href="#TCP-Interval" class="headerlink" title="TCP + Interval"></a>TCP + Interval</h3><p>Checks if the tcp connection attemp is successful.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"ssh"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"SSH TCP on port 22"</span>,</div><div class="line">    <span class="attr">"tcp"</span>: <span class="string">"localhost:22"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h3><p>Services report its status to Consul periodically over the HTTP, if no updates for the given TTL, the service will be marked as <code>cretical</code>.<br>Endpoint: <code>/v1/agent/check/pass/&lt;checkId&gt;</code></p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"web-app"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Web App Status"</span>,</div><div class="line">    <span class="attr">"notes"</span>: <span class="string">"Web app does a curl internally every 10 seconds"</span>,</div><div class="line">    <span class="attr">"ttl"</span>: <span class="string">"30s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Docker-Interval"><a href="#Docker-Interval" class="headerlink" title="Docker + Interval"></a>Docker + Interval</h3><p>Docker ported [Script + Interval]</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"mem-util"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">    <span class="attr">"docker_container_id"</span>: <span class="string">"f972c95ebf0e"</span>,</div><div class="line">    <span class="attr">"shell"</span>: <span class="string">"/bin/bash"</span>,</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Watches"><a href="#Watches" class="headerlink" title="Watches"></a>Watches</h2><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>Watch a specific KV pair.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"key"</span>,</div><div class="line">  <span class="attr">"key"</span>: <span class="string">"foo/bar/baz"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-key-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -<span class="built_in">type</span>=<span class="built_in">key</span> -<span class="built_in">key</span>=foo/<span class="built_in">bar</span>/baz /usr/bin/my-<span class="built_in">key</span>-handler.sh</div></pre></td></tr></table></figure>
<h3 id="keyprefix"><a href="#keyprefix" class="headerlink" title="keyprefix"></a>keyprefix</h3><p>Watch a prefix in the KV store.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"keyprefix"</span>,</div><div class="line">  <span class="attr">"prefix"</span>: <span class="string">"foo/"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-prefix-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -<span class="keyword">type</span>=keyprefix -<span class="keyword">prefix</span>=foo/ /usr/bin/my-<span class="keyword">prefix</span>-handler.sh</div></pre></td></tr></table></figure>
<h3 id="services"><a href="#services" class="headerlink" title="services"></a>services</h3><p>Watch the list of available services.</p>
<h3 id="nodes"><a href="#nodes" class="headerlink" title="nodes"></a>nodes</h3><p>Watch the list of nodes.</p>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>Watch the instances of a service.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"service"</span>,</div><div class="line">  <span class="attr">"service"</span>: <span class="string">"redis"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-service-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">consul</span> watch -<span class="keyword">type</span>=service -service=redis /usr/bin/my-service-handler.sh</div></pre></td></tr></table></figure>
<h3 id="checks"><a href="#checks" class="headerlink" title="checks"></a>checks</h3><p>Watch the value of health checks.</p>
<h3 id="event"><a href="#event" class="headerlink" title="event"></a>event</h3><p>Watch for custom user events.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"event"</span>,</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"web-deploy"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-deploy-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -type=event -<span class="built_in">name</span>=web-deploy /usr/bin/<span class="keyword">my</span>-deploy-handler.sh</div></pre></td></tr></table></figure>
<p>To fire a new <code>web-deploy</code> event:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul event -<span class="built_in">name</span>=web-deploy <span class="number">1609030</span></div></pre></td></tr></table></figure></p>
<h2 id="HTTP-API"><a href="#HTTP-API" class="headerlink" title="HTTP API"></a>HTTP API</h2><h3 id="ACLs"><a href="#ACLs" class="headerlink" title="ACLs"></a>ACLs</h3><h4 id="Create-ACL-Token"><a href="#Create-ACL-Token" class="headerlink" title="Create ACL Token"></a>Create ACL Token</h4><p>payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"my-app-token"</span>,</div><div class="line">  <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">  <span class="attr">"Rules"</span>: <span class="string">""</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ID</td>
<td>string</td>
<td>If not provided, a UUID is generated</td>
</tr>
<tr>
<td>Name</td>
<td>string</td>
<td>a human-friendly name for the ACL token</td>
</tr>
<tr>
<td>Type</td>
<td>string</td>
<td><code>client</code> (default) or <code>management</code></td>
</tr>
<tr>
<td>Rules</td>
<td>string</td>
<td>rules for this ACL token</td>
</tr>
</tbody>
</table>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="meta">@payload</span>.json <span class="string">http:</span><span class="comment">//localhost:8500/v1/acl/create</span></div></pre></td></tr></table></figure>
<h4 id="Update-ACL-Token"><a href="#Update-ACL-Token" class="headerlink" title="Update ACL Token"></a>Update ACL Token</h4><p>payload.json:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"adf4238a-882b-9ddc-4a9d-5b6758e4159e"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"my-app-token-updated"</span>,</div><div class="line">  <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">  <span class="attr">"Rules"</span>: <span class="string">"# New Rules"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="meta">@payload</span>.json <span class="string">http:</span><span class="comment">//localhost:8500/v1/acl/update</span></div></pre></td></tr></table></figure>
<h4 id="Delete-ACL-Token"><a href="#Delete-ACL-Token" class="headerlink" title="Delete ACL Token"></a>Delete ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http://localhost:<span class="number">8500</span>/v1/acl/destroy/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<h4 id="Read-ACL-Token"><a href="#Read-ACL-Token" class="headerlink" title="Read ACL Token"></a>Read ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/acl/destroy/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"CreateIndex"</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">"ModifyIndex"</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">"ID"</span>: <span class="string">"8f246b77-f3e1-ff88-5b48-8ec93abf3e05"</span>,</div><div class="line">    <span class="attr">"Name"</span>: <span class="string">"Client Token"</span>,</div><div class="line">    <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">    <span class="attr">"Rules"</span>: <span class="string">"..."</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<h4 id="Clone-ACL-Token"><a href="#Clone-ACL-Token" class="headerlink" title="Clone ACL Token"></a>Clone ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http://localhost:<span class="number">8500</span>/v1/acl/clone/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"adf4238a-882b-9ddc-4a9d-5b6758e4159e"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"service:redis"</span>: &#123;</div><div class="line">    <span class="attr">"Node"</span>: <span class="string">"foobar"</span>,</div><div class="line">    <span class="attr">"CheckID"</span>: <span class="string">"service:redis"</span>,</div><div class="line">    <span class="attr">"Name"</span>: <span class="string">"Service 'redis' check"</span>,</div><div class="line">    <span class="attr">"Status"</span>: <span class="string">"passing"</span>,</div><div class="line">    <span class="attr">"Notes"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"Output"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"ServiceID"</span>: <span class="string">"redis"</span>,</div><div class="line">    <span class="attr">"ServiceName"</span>: <span class="string">"redis"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="List-ACLs"><a href="#List-ACLs" class="headerlink" title="List ACLs"></a>List ACLs</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>acl<span class="regexp">/list</span></div></pre></td></tr></table></figure>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><p>From the local Consul agent’s point of view, might be different from other agents.</p>
<h4 id="List-Members"><a href="#List-Members" class="headerlink" title="List Members"></a>List Members</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/members</span></div></pre></td></tr></table></figure>
<h4 id="Read-Conf"><a href="#Read-Conf" class="headerlink" title="Read Conf"></a>Read Conf</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/self</span></div></pre></td></tr></table></figure>
<h4 id="Reload"><a href="#Reload" class="headerlink" title="Reload"></a>Reload</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/reload</span></div></pre></td></tr></table></figure>
<h4 id="Enable-Maintenance-Mode"><a href="#Enable-Maintenance-Mode" class="headerlink" title="Enable Maintenance Mode"></a>Enable Maintenance Mode</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/maintenance?enable=true&amp;reason=Upgration</span></div></pre></td></tr></table></figure>
<h4 id="Stream-Logs"><a href="#Stream-Logs" class="headerlink" title="Stream Logs"></a>Stream Logs</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/monitor</span></div></pre></td></tr></table></figure>
<h4 id="Join-Agent"><a href="#Join-Agent" class="headerlink" title="Join Agent"></a>Join Agent</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/join/</span>:address</div></pre></td></tr></table></figure>
<h4 id="Graceful-Leave"><a href="#Graceful-Leave" class="headerlink" title="Graceful Leave"></a>Graceful Leave</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/leave</span></div></pre></td></tr></table></figure>
<h4 id="Force-Leave"><a href="#Force-Leave" class="headerlink" title="Force Leave"></a>Force Leave</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/force-leave</span></div></pre></td></tr></table></figure>
<h3 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h3><p>Operating on <code>Check</code> by <code>agent</code> API.</p>
<h4 id="List-Checks"><a href="#List-Checks" class="headerlink" title="List Checks"></a>List Checks</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/checks</span></div></pre></td></tr></table></figure>
<h4 id="Register-Check"><a href="#Register-Check" class="headerlink" title="Register Check"></a>Register Check</h4><p>Sample payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"mem"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">  <span class="attr">"Notes"</span>: <span class="string">"Ensure we don't oversubscribe memory"</span>,</div><div class="line">  <span class="attr">"DeregisterCriticalServiceAfter"</span>: <span class="string">"90m"</span>,</div><div class="line">  <span class="attr">"Script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">  <span class="attr">"DockerContainerID"</span>: <span class="string">"f972c95ebf0e"</span>,</div><div class="line">  <span class="attr">"Shell"</span>: <span class="string">"/bin/bash"</span>,</div><div class="line">  <span class="attr">"HTTP"</span>: <span class="string">"http://example.com"</span>,</div><div class="line">  <span class="attr">"TCP"</span>: <span class="string">"example.com:22"</span>,</div><div class="line">  <span class="attr">"Interval"</span>: <span class="string">"10s"</span>,</div><div class="line">  <span class="attr">"TTL"</span>: <span class="string">"15s"</span>,</div><div class="line">  <span class="attr">"TLSSkipVerify"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d @payload.json http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>register</div></pre></td></tr></table></figure>
<h4 id="Deregister-Check"><a href="#Deregister-Check" class="headerlink" title="Deregister Check"></a>Deregister Check</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>deregister<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Pass"><a href="#TTL-Check-Pass" class="headerlink" title="TTL Check Pass"></a>TTL Check Pass</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>pass<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Warn"><a href="#TTL-Check-Warn" class="headerlink" title="TTL Check Warn"></a>TTL Check Warn</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>warn<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Fail"><a href="#TTL-Check-Fail" class="headerlink" title="TTL Check Fail"></a>TTL Check Fail</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>fail<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>Operating on <code>Check</code> by <code>agent</code> API.</p>
<h4 id="List-Services"><a href="#List-Services" class="headerlink" title="List Services"></a>List Services</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/services</span></div></pre></td></tr></table></figure>
<h3 id="Register-Service"><a href="#Register-Service" class="headerlink" title="Register Service"></a>Register Service</h3><p>Sample payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"redis1"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"redis"</span>,</div><div class="line">  <span class="attr">"Tags"</span>: [</div><div class="line">    <span class="string">"primary"</span>,</div><div class="line">    <span class="string">"v1"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"Address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">  <span class="attr">"Port"</span>: <span class="number">8000</span>,</div><div class="line">  <span class="attr">"EnableTagOverride"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"Check"</span>: &#123;</div><div class="line">    <span class="attr">"DeregisterCriticalServiceAfter"</span>: <span class="string">"90m"</span>,</div><div class="line">    <span class="attr">"Script"</span>: <span class="string">"/usr/local/bin/check_redis.py"</span>,</div><div class="line">    <span class="attr">"HTTP"</span>: <span class="string">"http://localhost:5000/health"</span>,</div><div class="line">    <span class="attr">"Interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"TTL"</span>: <span class="string">"15s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d @payload.json http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/service/</span>register</div></pre></td></tr></table></figure>
<h4 id="Deregister-Service"><a href="#Deregister-Service" class="headerlink" title="Deregister Service"></a>Deregister Service</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/service/</span>deregister<span class="regexp">/:service_id</span></div></pre></td></tr></table></figure>
<h4 id="Enable-Maintenance-Mode-1"><a href="#Enable-Maintenance-Mode-1" class="headerlink" title="Enable Maintenance Mode"></a>Enable Maintenance Mode</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/agent/service/maintenance/<span class="symbol">:service_id?enable=true&amp;reason=Upgration</span></div></pre></td></tr></table></figure>
<h3 id="Catelog"><a href="#Catelog" class="headerlink" title="Catelog"></a>Catelog</h3><p><a href="https://www.consul.io/api/catalog.html" target="_blank" rel="external">https://www.consul.io/api/catalog.html</a></p>
<h4 id="List-DataCenters"><a href="#List-DataCenters" class="headerlink" title="List DataCenters"></a>List DataCenters</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/datacenters</span></div></pre></td></tr></table></figure>
<h4 id="List-Services-1"><a href="#List-Services-1" class="headerlink" title="List Services"></a>List Services</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/services</span></div></pre></td></tr></table></figure>
<h4 id="List-Nodes-for-Service"><a href="#List-Nodes-for-Service" class="headerlink" title="List Nodes for Service"></a>List Nodes for Service</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/service/</span>:service</div></pre></td></tr></table></figure>
<h4 id="List-Services-for-Node"><a href="#List-Services-for-Node" class="headerlink" title="List Services for Node"></a>List Services for Node</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/catalog/<span class="keyword">node</span><span class="title">/:node</span></div></pre></td></tr></table></figure>
<h3 id="Health"><a href="#Health" class="headerlink" title="Health"></a>Health</h3><h4 id="Critical-Service"><a href="#Critical-Service" class="headerlink" title="Critical Service"></a>Critical Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/critical</div></pre></td></tr></table></figure>
<h4 id="Passing-Service"><a href="#Passing-Service" class="headerlink" title="Passing Service"></a>Passing Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/passing</div></pre></td></tr></table></figure>
<h4 id="Warning-Service"><a href="#Warning-Service" class="headerlink" title="Warning Service"></a>Warning Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/warning</div></pre></td></tr></table></figure>
<h3 id="KV-Store"><a href="#KV-Store" class="headerlink" title="KV Store"></a>KV Store</h3><h4 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/kv/<span class="symbol">:key</span></div><div class="line">curl <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/kv/<span class="symbol">:key?recurse=true</span></div></pre></td></tr></table></figure>
<h4 id="Create-Update-Key"><a href="#Create-Update-Key" class="headerlink" title="Create/Update Key"></a>Create/Update Key</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="string">"value"</span> http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>kv<span class="regexp">/:key</span></div></pre></td></tr></table></figure>
<h4 id="Delete-Key"><a href="#Delete-Key" class="headerlink" title="Delete Key"></a>Delete Key</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -X <span class="keyword">DELETE</span> <span class="keyword">http</span>://localhost:<span class="number">8500</span>/v1/kv/:<span class="keyword">key</span></div><div class="line">curl -X <span class="keyword">DELETE</span> <span class="keyword">http</span>://localhost:<span class="number">8500</span>/v1/kv/:<span class="keyword">key</span>?recurse=<span class="literal">true</span></div></pre></td></tr></table></figure>


			
            <div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = undefined;
this.page.identifier = http://www.orctom.com/2017/05/22/consul/;
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://orctom.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </div>
    </div>
</article>

    <footer id="footer">
    	
        <small>&copy; 2017 orctom</small>
    </footer>

</body>
</html>

