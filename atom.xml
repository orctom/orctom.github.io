<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>orctom</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.orctom.com/"/>
  <updated>2017-11-13T03:47:09.785Z</updated>
  <id>http://www.orctom.com/</id>
  
  <author>
    <name>orctom</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Introduction to Speech Recognition</title>
    <link href="http://www.orctom.com/2017/11/12/introduction-to-speech-recognition/"/>
    <id>http://www.orctom.com/2017/11/12/introduction-to-speech-recognition/</id>
    <published>2017-11-12T13:35:25.464Z</published>
    <updated>2017-11-13T03:47:09.785Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Pre-processing"><a href="#Pre-processing" class="headerlink" title="Pre-processing"></a>Pre-processing</h3><ul>
<li>Window: process the data window by window, as human voices have a duration of consistency within the range of 20ms to 50ms, generally we take 25ms. And make the step size of 10ms.</li>
<li>FFT: converting raw wave data to frequency data.</li>
<li>Cut: keep only a range of frequency data, that most human voices cover.</li>
<li>Other… (DCT)</li>
<li>Feature Extraction<ul>
<li>MFCC (mel-frequency cepstral coefficient), 39 dimentions</li>
<li>PLP (perceptual linear prediction), 42 dimentions</li>
</ul>
</li>
</ul>
<h3 id="Acoustic-Model"><a href="#Acoustic-Model" class="headerlink" title="Acoustic Model"></a>Acoustic Model</h3><ul>
<li>Acoustic model is a classification model, who’s input is the fetures, MFCC/PLP…, while output is the <code>phoneme</code>s, about 70 most frequently used.</li>
<li>Unsupervised learning</li>
<li>GMM + HMM / HMM + LSTM</li>
<li>Baum-Welch(EM) / MLE</li>
</ul>
<h4 id="GMM-HMM"><a href="#GMM-HMM" class="headerlink" title="GMM + HMM"></a>GMM + HMM</h4><h4 id="tri-phoneme-model"><a href="#tri-phoneme-model" class="headerlink" title="tri-phoneme model"></a>tri-phoneme model</h4><p>Each phoneme in different context, may pronounce differently.<br>So setup a </p>
<h3 id="Lexicon-Model"><a href="#Lexicon-Model" class="headerlink" title="Lexicon Model"></a>Lexicon Model</h3><h3 id="Language-Model"><a href="#Language-Model" class="headerlink" title="Language Model"></a>Language Model</h3><p>Making the sequence of words more like a human speech</p>
<ul>
<li>n-gram</li>
<li></li>
</ul>
<h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><ul>
<li>Labels marked by human</li>
<li>Language model</li>
<li>Laxicon model<br>Represented by a HMM model</li>
</ul>
<h2 id="Decoding"><a href="#Decoding" class="headerlink" title="Decoding"></a>Decoding</h2><h2 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h2><h3 id="GMM"><a href="#GMM" class="headerlink" title="GMM"></a>GMM</h3><h3 id="HMM"><a href="#HMM" class="headerlink" title="HMM"></a>HMM</h3><ul>
<li>Transition posibilities</li>
<li>Observation states</li>
<li>Hidden stats</li>
</ul>
<p>Problem &amp; Solution</p>
<ul>
<li>概率计算问题即模型评价问题——前向算法和后向算法</li>
<li>学习问题即参数估计问题——Baum-Welch算法</li>
<li>预测问题即解码问题——Viterbi算法</li>
</ul>
<h3 id="Viterbi"><a href="#Viterbi" class="headerlink" title="Viterbi"></a>Viterbi</h3><p>[Viterbi animated demo]{<a href="https://upload.wikimedia.org/wikipedia/commons/7/73/Viterbi_animated_demo.gif}" target="_blank" rel="external">https://upload.wikimedia.org/wikipedia/commons/7/73/Viterbi_animated_demo.gif}</a></p>
<h2 id="Summerize"><a href="#Summerize" class="headerlink" title="Summerize"></a>Summerize</h2><h3 id="Fumular"><a href="#Fumular" class="headerlink" title="Fumular"></a>Fumular</h3><p>$$ W* = argmaxP(W|X) $$</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Overview&quot;&gt;&lt;a href=&quot;#Overview&quot; class=&quot;headerlink&quot; title=&quot;Overview&quot;&gt;&lt;/a&gt;Overview&lt;/h2&gt;&lt;h3 id=&quot;Pre-processing&quot;&gt;&lt;a href=&quot;#Pre-processing&quot;
    
    </summary>
    
    
      <category term="asr" scheme="http://www.orctom.com/tags/asr/"/>
    
      <category term="ml" scheme="http://www.orctom.com/tags/ml/"/>
    
  </entry>
  
  <entry>
    <title>AMQP</title>
    <link href="http://www.orctom.com/2017/05/24/amqp/"/>
    <id>http://www.orctom.com/2017/05/24/amqp/</id>
    <published>2017-05-24T14:13:14.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Technical-Terminology"><a href="#Technical-Terminology" class="headerlink" title="Technical Terminology"></a>Technical Terminology</h3><ul>
<li><strong>Connection</strong>: A network connection, e.g. a TCP/IP socket connection</li>
<li><strong>Channel</strong>: A bi-directional stream of communications between two AMQP peers. Channels are multiplexed so that a single network connection can carry multiple channels</li>
<li><strong>Client</strong>: The initiator of an AMQP connection or channel. AMQP is not symmetrical. Clients produce and consume messages while servers queue and route messages</li>
<li><strong>Server</strong>: The process that accepts client connections and implements the AMQP message queueing and routing functions. Also known as “broker”</li>
<li><strong>Peer</strong>: Either party in an AMQP connection. An AMQP connection involves exactly two peers (one is the client, one is the server)</li>
<li><strong>Frame</strong>: A formally-defined package of connection data. Contiguously - as a single unit - on the connection</li>
<li><strong>Protocol Class</strong>: A collection of AMQP commands (also known as Methods) that deal with a specific type of functionality</li>
<li><strong>Method</strong>: A specific type of AMQP command frame that passes instructions from one peer to the other</li>
<li><strong>Content</strong>: Application data passed from client to server and from server to client. AMQP content can be structured into multiple parts. The term is synonymous with “message”</li>
<li><strong>Content Header</strong>: A specific type of frame that describes a content’s properties</li>
<li><strong>Content Body</strong>: A specific type of frame that contains raw application data. Content body frames are entirely opaque - the server does not examine or modify these in any way</li>
<li><strong>Message</strong>: Synonymous with “content”</li>
<li><strong>Exchange</strong>: The entity within the server which receives messages from producer applications and optionally routes these to message queues within the server</li>
<li><strong>Exchange Type</strong>: The algorithm and implementation of a particular model of exchange. In contrast to the “exchange instance”, which is the entity that receives and routes messages within the server</li>
<li><strong>Message queue</strong>: A named entity that holds messages and forwards them to consumer applications.</li>
<li><strong>Binding</strong>: An entity that creates a relationship between a message queue and an exchange</li>
<li><strong>Routing key</strong>: A virtual address that an exchange may use to decide how to route a specific message</li>
<li><strong>Durable</strong>: A server resource that survives a server restart</li>
<li><strong>Transient</strong>: A server resource that is wiped or reset after a server restart</li>
<li><strong>Persistent</strong>: A message that the server holds on reliable disk storage and MUST NOT lose after a server restart</li>
<li><strong>Non-persistent</strong>: A message that the server holds in memory and MAY lose after a server restart</li>
<li><strong>Consumer</strong>: A client application that requests messages from a message queue</li>
<li><strong>Producer</strong>: A client application that publishes messages to an exchange</li>
<li><strong>Virtual host</strong>: A collection of exchanges, message queues and associated objects. Virtual hosts are independent server domains that share a common authentication and encryption environment. The client application chooses a virtual host after logging in to the server</li>
<li><strong>Realm</strong>: A set of server resources (exchanges and message queues) covered by a single security policy and access control. Applications ask for access rights for specific realms, rather than for specific resources</li>
<li><strong>Ticket</strong>: A token that a server provides to a client, for access to a specific realm</li>
<li><strong>Streaming</strong>: The process by which the server will send messages to the client at a pre-arranged rate</li>
<li><strong>Staging</strong>: The process by which a peer will transfer a large message to a temporary holding area before formally handing it over to the recipient. This is how AMQP implements re-startable file transfers</li>
<li><strong>Out-of-band transport</strong>: The technique by which data is carried outside the network connection. For example, one might send data across TCP/IP and then switch to using shared memory if one is talking to a peer on the same system</li>
<li><strong>Zero copy</strong>: The technique of transferring data without copying it to or from intermediate buffers. Zero copy requires that the protocol allows the out-of-band transfer of data as opaque blocks, as AMQP does</li>
<li><strong>Assertion</strong>: A condition that must be true for processing to continue</li>
<li><strong>Exception</strong>: A failed assertion, handled by closing either the Channel or the Connection</li>
<li><strong>Topic:</strong> Usually a means of distributing messages; AMQP implements topics using one or more types of exchange</li>
<li><strong>Subscription</strong>: Usually a request to receive data from topics; AMQP implements subscriptions as message queues and bindings</li>
<li><strong>Service</strong>: Usually synonymous with server. The AMQP standard uses “server” to conform with IETF standard nomenclature and to clarify the roles of each party in the protocol (both sides may be AMQP services)</li>
<li><strong>Broker</strong>: synonymous with server. The AMQP standard uses the terms “client” and “server” to conform with IETF standard nomenclature.</li>
<li><strong>Router</strong>: Sometimes used to describe the actions of an exchange. However exchanges can do more than message routing (they can also act as message end-points), and the term “router” has special significance in the network domain, so AMQP avoids using it.</li>
</ul>
<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><h4 id="AMQP-Model"><a href="#AMQP-Model" class="headerlink" title="AMQP Model"></a>AMQP Model</h4><h5 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h5><p>Channels are something like sessions.</p>
<h5 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h5><p>Where messages been put by producers.<br>Receives mesages from publishers and routes them to “message queue”, based on arbitrary criteria, usually message properties or content.</p>
<hr>
<p><strong>Exchange Types</strong></p>
<h6 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h6><p>Only one bound queue will see a given message. (Pool of workers)</p>
<h6 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h6><p>Every bound queues will see the same messages. (Pub/Sub)</p>
<h6 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h6><p>Fanout + routing keys support (filtering)</p>
<hr>
<h5 id="Message-Queue"><a href="#Message-Queue" class="headerlink" title="Message Queue"></a>Message Queue</h5><p>Where messages been read by receviers.<br>Stores messages until they can be safely processed by consumer(s).</p>
<h5 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h5><p>How the messages been routed from Exchanges to Queues.<br>Defines the relationship between a message queue and an exchange, and provides the message routing criteeria.</p>
<h3 id="NPM-libs"><a href="#NPM-libs" class="headerlink" title="NPM libs"></a>NPM libs</h3><table>
<thead>
<tr>
<th style="text-align:center">Lib</th>
<th style="text-align:center">Exchanges, Queues</th>
<th style="text-align:center">Channels</th>
<th style="text-align:center">Bindings</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">node-amqp</td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-remove"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
</tr>
<tr>
<td style="text-align:center">amqplib</td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
</tr>
<tr>
<td style="text-align:center">rabbit.js</td>
<td style="text-align:center"><i class="glyphicon glyphicon-remove"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-remove"></i></td>
<td style="text-align:center"><i class="glyphicon glyphicon-ok"></i></td>
</tr>
</tbody>
</table>
<h3 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h3><h4 id="Output-logstash-gt-mq"><a href="#Output-logstash-gt-mq" class="headerlink" title="Output (logstash -&gt; mq)"></a>Output (logstash -&gt; mq)</h4><blockquote>
<p>exchange: “was”<br>exchange_type: “fanout” # one of [“fanout”, “direct”, “topic”]<br>key: “logstash”</p>
</blockquote>
<h4 id="Input-mq-gt-logstash"><a href="#Input-mq-gt-logstash" class="headerlink" title="Input (mq -&gt; logstash)"></a>Input (mq -&gt; logstash)</h4><blockquote>
<p>arguments: {}<br>auto_delete: false<br>exchange: “was”<br>exclusive: false<br>key: “logstash”<br>passive: false<br>queue: “”</p>
</blockquote>
<h3 id="Some-links"><a href="#Some-links" class="headerlink" title="Some links"></a>Some links</h3><ul>
<li><a href="https://www.amqp.org/" target="_blank" rel="external">https://www.amqp.org/</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Technical-Terminology&quot;&gt;&lt;a href=&quot;#Technical-Terminology&quot; class=&quot;headerlink&quot; title=&quot;Technical Terminology&quot;&gt;&lt;/a&gt;Technical Terminology&lt;/
    
    </summary>
    
    
      <category term="mq" scheme="http://www.orctom.com/tags/mq/"/>
    
      <category term="amqp" scheme="http://www.orctom.com/tags/amqp/"/>
    
  </entry>
  
  <entry>
    <title>Newton&#39;s Method</title>
    <link href="http://www.orctom.com/2017/05/24/newton-s-method/"/>
    <id>http://www.orctom.com/2017/05/24/newton-s-method/</id>
    <published>2017-05-24T14:13:14.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Formula"><a href="#Formula" class="headerlink" title="Formula"></a>Formula</h2><p>$$ x_{i + 1} = x_i - \frac{f(x_i)}{f’(x_i)} $$<br>Where <code>f&#39;(x)</code> is the derivative.  </p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>Say you want to find the value of x in $ x^3 + x - 1 = 0 $<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></div><div class="line">  <span class="keyword">return</span> x**<span class="number">3</span> + x <span class="number">-1</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">(x)</span>:</span> <span class="comment"># derivative</span></div><div class="line">  <span class="keyword">return</span> <span class="number">3</span>*x**<span class="number">2</span> + <span class="number">1</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">newton</span><span class="params">(x, e)</span>:</span></div><div class="line">  <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">if</span> d(x) == <span class="number">0</span>:</div><div class="line">      <span class="keyword">return</span> x</div><div class="line">    old = x</div><div class="line">    x = x - f(x)/d(x)</div><div class="line">    <span class="keyword">if</span> abs(x - old) &lt;= e:</div><div class="line">      <span class="keyword">return</span> x</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">  <span class="keyword">print</span> newton(<span class="number">12.00</span>, <span class="number">0.0000001</span>)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Formula&quot;&gt;&lt;a href=&quot;#Formula&quot; class=&quot;headerlink&quot; title=&quot;Formula&quot;&gt;&lt;/a&gt;Formula&lt;/h2&gt;&lt;p&gt;$$ x_{i + 1} = x_i - \frac{f(x_i)}{f’(x_i)} $$&lt;br&gt;
    
    </summary>
    
    
      <category term="math" scheme="http://www.orctom.com/tags/math/"/>
    
  </entry>
  
  <entry>
    <title>MQTT</title>
    <link href="http://www.orctom.com/2017/05/24/mqtt/"/>
    <id>http://www.orctom.com/2017/05/24/mqtt/</id>
    <published>2017-05-24T14:13:14.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>MQ Telemetry Transport</p>
<h3 id="Why-MQTT"><a href="#Why-MQTT" class="headerlink" title="Why MQTT"></a>Why MQTT</h3><ul>
<li>Designed for constrained networks<br>– Protocol compressed into bit-wise headers and variable length fields.<br>– Smallest possible packet size is 2 bytes<br>– Asynchronous <strong>bidirectional</strong> “push” delivery of messages to applications (no polling)<ul>
<li>Client to server and server to client – Supports always-connected and sometimes-connected models – Provides Session awareness</li>
<li>Configurable keep alive providing granular session awareness</li>
<li>“Last will and testament” enable applications to know when a client goes offline abnormally<br>– Typically utilises TCP based networks e.g. Webscokets<br>– Suitable for IoT, M2M</li>
</ul>
</li>
<li>Designed for constrained devices<ul>
<li>Low CPU, memory, battery</li>
</ul>
</li>
</ul>
<h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><h4 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h4><ul>
<li>A topic forms the namespace</li>
<li>Hierarchical with each “sub topic” separated by a /</li>
<li>Supports wildcards for subscribers<ul>
<li>Single-level wildcards “+” can appear anywhere in the topic string<br>– Multi-level wildcards “#” must appear at the end of the string<br>– Wildcards must be next to a separator</li>
</ul>
</li>
</ul>
<h4 id="Duable"><a href="#Duable" class="headerlink" title="Duable"></a>Duable</h4><p>When subscriber disconnected, messages will be stored on server until the subscriber connects again.<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MqttConnectOptions.setCleanSession(false)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<h4 id="Retain"><a href="#Retain" class="headerlink" title="Retain"></a>Retain</h4><p>A publisher can mark a publication as retained, the server will give this last known good message to new substribers.<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MqttMessage.setRetained(true)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<h4 id="QoS-Quality-of-Service"><a href="#QoS-Quality-of-Service" class="headerlink" title="QoS (Quality of Service)"></a>QoS (Quality of Service)</h4><ul>
<li>0: message will be delivered at most once</li>
<li>1: message will be delivered but may be duplicated</li>
<li>2: message will be delivered exactly once</li>
</ul>
<h3 id="Softwares"><a href="#Softwares" class="headerlink" title="Softwares"></a>Softwares</h3><h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><ul>
<li><a href="http://mosquitto.org/" target="_blank" rel="external">Mosquitto</a></li>
<li><a href="http://emqtt.io/" target="_blank" rel="external">emqttd</a> (Erlang based)</li>
<li><a href="http://rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> with <a href="https://www.rabbitmq.com/mqtt.html" target="_blank" rel="external">MQTT Adapter</a></li>
<li><a href="https://github.com/andsel/moquette" target="_blank" rel="external">moquette</a> (Java based, embeddable, <a href="http://www.freedomotic.com/" target="_blank" rel="external">freedomotic</a>)</li>
<li><a href="https://github.com/mcollina/mosca" target="_blank" rel="external">Mosca</a> (node,js broker)</li>
</ul>
<h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><ul>
<li><a href="https://github.com/knolleary/pubsubclient" target="_blank" rel="external">Arduino</a></li>
<li><a href="http://www.eclipse.org/paho" target="_blank" rel="external">Paho</a></li>
<li><a href="https://github.com/andsel/moquette" target="_blank" rel="external">moquette</a></li>
<li><a href="https://github.com/fusesource/mqtt-client" target="_blank" rel="external">Fusesource mqtt-client</a></li>
<li><a href="https://github.com/TwoGuysFromKabul/xenqtt" target="_blank" rel="external">xenqtt</a> (with mocks…)</li>
</ul>
<h3 id="Some-links"><a href="#Some-links" class="headerlink" title="Some links"></a>Some links</h3><ul>
<li>Offical site<ul>
<li><a href="http://mqtt.org" target="_blank" rel="external">http://mqtt.org</a></li>
</ul>
</li>
<li>Wiki<ul>
<li><a href="https://github.com/mqtt/mqtt.github.io/wiki" target="_blank" rel="external">https://github.com/mqtt/mqtt.github.io/wiki</a></li>
</ul>
</li>
<li>Eclipse Paho<ul>
<li><a href="http://www.eclipse.org/paho" target="_blank" rel="external">http://www.eclipse.org/paho</a></li>
</ul>
</li>
<li>Utilities<ul>
<li><a href="http://mqtt.io/" target="_blank" rel="external">mqtt.io</a>, web based</li>
<li><a href="http://mqttfx.jfx4ee.org/" target="_blank" rel="external">mqttfx</a>, a JavaFX based MQTT Client</li>
<li><a href="https://github.com/kamilfb/mqtt-spy" target="_blank" rel="external">mqtt-spy</a>, based on JavaFX, Java 8</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MQ Telemetry Transport&lt;/p&gt;
&lt;h3 id=&quot;Why-MQTT&quot;&gt;&lt;a href=&quot;#Why-MQTT&quot; class=&quot;headerlink&quot; title=&quot;Why MQTT&quot;&gt;&lt;/a&gt;Why MQTT&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Designed f
    
    </summary>
    
    
      <category term="IoT" scheme="http://www.orctom.com/tags/IoT/"/>
    
      <category term="mq" scheme="http://www.orctom.com/tags/mq/"/>
    
  </entry>
  
  <entry>
    <title>Json Web Token</title>
    <link href="http://www.orctom.com/2017/05/24/jwt/"/>
    <id>http://www.orctom.com/2017/05/24/jwt/</id>
    <published>2017-05-24T14:13:14.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="What-is-Json-Web-Token"><a href="#What-is-Json-Web-Token" class="headerlink" title="What is Json Web Token"></a>What is Json Web Token</h3><p>A compact, URL-safe means of representing claims to be transferred between two parties.<br>The server side creates a signature with a preconfigured secret key, and send the signature with the content to client.<br>When the client visit the server again with the token, the server can verify the token to trust the content in the token, without looking up databases.<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">hash</span><span class="params">(user_info + secret_key)</span></span></div></pre></td></tr></table></figure></p>
<h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span>.<span class="tag">&lt;<span class="name">payload</span>&gt;</span>.<span class="tag">&lt;<span class="name">signature</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="header"><a href="#header" class="headerlink" title="header"></a>header</h4><p>Base64Url encoded of json such as:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"alg"</span>: <span class="string">"HS256"</span>,</div><div class="line">  <span class="attr">"typ"</span>: <span class="string">"JWT"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Standard fields:</p>
<ul>
<li>Token type (typ)</li>
<li>Content type (cty): This claim should always be <code>JWT</code></li>
<li>Algorithm (alg): <code>HS256</code></li>
</ul>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>A.K.A claims, which are the statements of the users, and additional metadata.<br>Base64Url encoded of json such as:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"John Doe"</span>,</div><div class="line">  <span class="attr">"admin"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Standard fields:</p>
<ul>
<li>Issuer (iss): The principal that issued the token</li>
<li>Subject (sub): The subject of the token</li>
<li>Audience (aud):  The claim or user that the token is issued for</li>
<li>Expiration time (exp): Expiration time</li>
<li>Not before (nbf): Similarly, the not-before time claim identifies the time on which the JWT will start to be accepted for processing.</li>
<li>Issued at (iat) - The “iat” (issued at) claim identifies the time at which the JWT was issued</li>
<li>JWT ID (jti) - case sensitive unique identifier of the token even among different issuers</li>
</ul>
<h4 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HMACSHA256(<span class="tag">&lt;<span class="name">header</span>&gt;</span>.<span class="tag">&lt;<span class="name">payload</span>&gt;</span>, <span class="tag">&lt;<span class="name">your_secure</span>&gt;</span>)</div></pre></td></tr></table></figure>
<h4 id="Putting-all-together"><a href="#Putting-all-together" class="headerlink" title="Putting all together"></a>Putting all together</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">|<span class="type">&lt;---- header</span> -----&gt;|       <span class="type">|&lt;----- payload</span> -----&gt;|       <span class="type">|&lt;----------------------- signature</span> --------------------------&gt;|</div><div class="line"><span class="type">base64Encode</span>(header) + <span class="string">"."</span> + base64Encode(payload) + <span class="string">"."</span> + HMACSHA256(base64Encode(header + <span class="string">"."</span> + payload), &lt;your_secure&gt;)</div></pre></td></tr></table></figure>
<h3 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h3><ul>
<li>Server generates a <code>secret</code> (prepare before startup) and make it secure, and avaialbe only to server.</li>
<li>Client requests for a token. (by using credential to identify the client is a valid client)</li>
<li>Server generates a <code>token</code> with a <code>secret</code>.</li>
<li>Server returns the <code>token</code>.</li>
<li>Client stores the <code>token</code> to local storage.</li>
<li>Client visits protected resources on server with the <code>token</code>.<ul>
<li>Typically in the <em>Authorization</em> header</li>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
</li>
<li>Server verifies the <code>token</code>‘s signature by creating a signature and comparing if the two are equal, then retrives client informations, without looking up databases.</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;What-is-Json-Web-Token&quot;&gt;&lt;a href=&quot;#What-is-Json-Web-Token&quot; class=&quot;headerlink&quot; title=&quot;What is Json Web Token&quot;&gt;&lt;/a&gt;What is Json Web Tok
    
    </summary>
    
    
      <category term="security" scheme="http://www.orctom.com/tags/security/"/>
    
  </entry>
  
  <entry>
    <title>Some Calculus Formulas</title>
    <link href="http://www.orctom.com/2017/05/24/some-calculus-formulas/"/>
    <id>http://www.orctom.com/2017/05/24/some-calculus-formulas/</id>
    <published>2017-05-24T14:13:14.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Derivative"><a href="#Derivative" class="headerlink" title="Derivative"></a>Derivative</h2><h3 id="Polynomial"><a href="#Polynomial" class="headerlink" title="Polynomial"></a>Polynomial</h3><ol>
<li>$ c’ = 0 $</li>
<li>$ x’ = 1 $</li>
<li>$ (cx)’ = c $</li>
<li>$ |x|’ = \frac{x}{|x|}, x \ne 0 $</li>
<li>$ (x^c)’ = cx^{c-1} $</li>
<li>$ \left(\frac 1 x\right)’ = (x^{-1})’ = -x^{-2} = - \frac {1} {x^2} $</li>
<li>$ \left(\frac 1 {x^c}\right)’ = (x^{-c})’ = -cx^{-c-1} = - \frac {1} {x^{c+1}} $</li>
<li>$ \left(\sqrt{x}\right)’ = \left(\frac 1 {x^{1/2}}\right)’ = \frac{1}{2} x^{-1/2} = \frac{1}{2\sqrt{x}}, x \gt 0 $</li>
</ol>
<h3 id="Exponential-Logarithmic"><a href="#Exponential-Logarithmic" class="headerlink" title="Exponential / Logarithmic"></a>Exponential / Logarithmic</h3><ol>
<li>$ (c^x)’ = c^x \ln{c}, c \gt 0 $</li>
<li>$ (e^x)’ = e^x $</li>
<li>$ (\log_cx)’ = \frac{1}{x\ln{c}}, c \gt0, c \ne 1 $</li>
<li>$ (\ln{x})’ = \frac{1}{x}, x \gt 0 $</li>
<li>$ (\ln{|x|})’ = \frac{1}{x} $</li>
<li>$ (x^x)’ = x^x(1 + \ln{x}) $</li>
</ol>
<h3 id="Trigonometric"><a href="#Trigonometric" class="headerlink" title="Trigonometric"></a>Trigonometric</h3><ol>
<li>$ (\sin{x})’ = \cos{x} $</li>
<li>$ (\cos{x})’ = -\sin{x} $</li>
<li>$ (\tan{x})’ = \sec^2{x} = \frac{1}{\cos^2x} $</li>
<li>$ (\sec{x})’ = \sec{x} * \tan{x} $</li>
<li>$ (\csc{x})’ = -\csc{x} * \cot{x} $</li>
<li>$ (\cot{x})’ = -\csc^2{x} = \frac{-1}{\sin^2{x}} $</li>
<li>$ (\arcsin{x})’ = \frac{1}{\sqrt{1 - x^2}} $</li>
<li>$ (\arccos{x})’ = \frac{-1}{\sqrt{1 - x^2}} $</li>
<li>$ (\arctan{x})’ = \frac{1}{1 + x^2} $</li>
<li>$ (arcsec \hskip1pt x)’ = \frac{1}{|x|\sqrt{x^2 - 1}} $</li>
<li>$ (arccsc \hskip1pt x)’ = \frac{-1}{|x|\sqrt{x^2 - 1}} $</li>
<li>$ (arccot \hskip1pt x)’ = \frac{-1}{1 + x^2} $</li>
</ol>
<h3 id="Hyperbolic"><a href="#Hyperbolic" class="headerlink" title="Hyperbolic"></a>Hyperbolic</h3><ol>
<li>$ (\sinh{x})’ = \cosh{x} = \frac{e^x + e^{-x}}{2} $</li>
<li>$ (\cosh{x})’ = \sinh{x} = \frac{e^x - e^{-x}}{2} $</li>
<li>$ (\tanh{x})’ = sech^2 \hskip1pt {x} $</li>
<li>$ (sech \hskip1pt {x})’ = -\tanh{x} * sech \hskip1pt {x} $</li>
<li>$ (csch \hskip1pt {x})’ = -\coth{x} * csch \hskip1pt {x} $</li>
<li>$ (\coth{x})’ = - csch^2 \hskip1pt {x} $</li>
<li>$ (arcsinh \hskip1pt {x})’ = \frac{1}{\sqrt{x^2 + 1}} $</li>
<li>$ (arccosh \hskip1pt {x})’ = \frac{1}{\sqrt{x^2 - 1}}, x \gt 1 $</li>
<li>$ (arctanh \hskip1pt {x})’ = \frac{1}{1 - |x|^2}, |x| \lt 1 $</li>
<li>$ (arsech \hskip1pt {x})’ = \frac{-1}{x\sqrt{1 - x^2}} $</li>
<li>$ (arcsch \hskip1pt {x})’ = \frac{-1}{x\sqrt{1 + x^2}} $</li>
<li>$ (arcoth \hskip1pt {x})’ = \frac{1}{1 - |x|^2}, |x| \gt 1 $</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Derivative&quot;&gt;&lt;a href=&quot;#Derivative&quot; class=&quot;headerlink&quot; title=&quot;Derivative&quot;&gt;&lt;/a&gt;Derivative&lt;/h2&gt;&lt;h3 id=&quot;Polynomial&quot;&gt;&lt;a href=&quot;#Polynomial&quot;
    
    </summary>
    
      <category term="math" scheme="http://www.orctom.com/categories/math/"/>
    
    
      <category term="calculus" scheme="http://www.orctom.com/tags/calculus/"/>
    
  </entry>
  
  <entry>
    <title>Consul</title>
    <link href="http://www.orctom.com/2017/05/22/consul/"/>
    <id>http://www.orctom.com/2017/05/22/consul/</id>
    <published>2017-05-22T15:18:36.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Download package from <a href="https://www.consul.io/downloads.html" target="_blank" rel="external">https://www.consul.io/downloads.html</a>, and unzip to ~/bin or /usr/local/bin.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">https:</span><span class="comment">//releases.hashicorp.com/consul/0.8.3/consul_0.8.3_linux_amd64.zip -o /tmp/consul.zip;</span></div><div class="line">unzip <span class="regexp">/tmp/</span>consul.zip -d <span class="regexp">/usr/</span>local/bin</div></pre></td></tr></table></figure></p>
<h2 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h2><p><a href="https://www.consul.io/docs/agent/options.html" target="_blank" rel="external">Options for consul agent</a></p>
<h3 id="Dev-Mode"><a href="#Dev-Mode" class="headerlink" title="Dev Mode"></a>Dev Mode</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">consul agent -dev</span></div></pre></td></tr></table></figure>
<h3 id="With-UI"><a href="#With-UI" class="headerlink" title="With UI"></a>With UI</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">consul agent -dev -ui</span></div></pre></td></tr></table></figure>
<h3 id="More-Options"><a href="#More-Options" class="headerlink" title="More Options"></a>More Options</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">bootstrap-expect=<span class="number">3</span> \           <span class="comment">## Consul waits until the specified number of servers are available and then bootstraps the cluster</span></span></div><div class="line">  -<span class="ruby">bind=<span class="number">10.0</span>.<span class="number">20.1</span> \               <span class="comment">## If you have multi local IPs, choose one manually. Otherwize it will fail</span></span></div><div class="line">  -<span class="ruby">client=<span class="number">10.0</span>.<span class="number">20.1</span> \             <span class="comment">## Don't set it, unless you expects the HTTP, DNS and RPC servers be exposed to non-127.0.0.1</span></span></div><div class="line">  -<span class="ruby">config-dir=<span class="regexp">/etc/consul</span>.d/ \    <span class="comment">## A directory of configuration files (.json) to load</span></span></div><div class="line">  -<span class="ruby">data-dir=~<span class="regexp">/usr/local</span><span class="regexp">/consul/</span> \ <span class="comment">## Persistent state, the directory must be durable across reboots</span></span></div><div class="line">  -<span class="ruby">datacenter=uat \               <span class="comment">## Default: `dc1`. Nodes in the same datacenter should be on a single LAN</span></span></div><div class="line">  -<span class="ruby">encrypt=&lt;<span class="string">`consul keygen`</span>&gt; \    <span class="comment">## All nodes in the cluster share the same key, used for messages between agents</span></span></div><div class="line">  -<span class="ruby">node=node_name \               <span class="comment">## Default: `$hostname`, must be unique within the cluster</span></span></div><div class="line">  -<span class="ruby">server \                       <span class="comment">## Server mode, otherwise client mode</span></span></div><div class="line">  -<span class="ruby">ui                             <span class="comment">## Enable the default dashboard on http://localhost:8500/ui</span></span></div></pre></td></tr></table></figure>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>Dev Mode:<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker run -d \</div><div class="line">  -<span class="ruby">-name consul \</span></div><div class="line">  -<span class="ruby">p <span class="number">8300</span><span class="symbol">:</span><span class="number">8300</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8400</span><span class="symbol">:</span><span class="number">8400</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8500</span><span class="symbol">:</span><span class="number">8500</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">8600</span><span class="symbol">:</span><span class="number">8600</span> \</span></div><div class="line">  consul</div></pre></td></tr></table></figure></p>
<h3 id="hashi-ui"><a href="#hashi-ui" class="headerlink" title="hashi-ui"></a>hashi-ui</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">docker run -d \</div><div class="line">  -<span class="ruby">-name=hashi-ui \</span></div><div class="line">  -<span class="ruby">e CONSUL_ENABLE=<span class="number">1</span> \</span></div><div class="line">  -<span class="ruby">e CONSUL_ADDR=&lt;ip&gt;<span class="symbol">:&lt;port&gt;</span> \</span></div><div class="line">  -<span class="ruby">p <span class="number">3000</span><span class="symbol">:</span><span class="number">3000</span> \</span></div><div class="line">  jippi/hashi-ui</div></pre></td></tr></table></figure>
<h2 id="Used-Ports"><a href="#Used-Ports" class="headerlink" title="Used Ports"></a>Used Ports</h2><ul>
<li>8300: server RPC, TCP only, handle RPC from other agents</li>
<li>8301: gossip in LAN, TCP and UDP, required</li>
<li>8302: gossip over WAN, TCP and UDP</li>
<li>8400: cli RPC, TCP only, handle RPC from cli</li>
<li>8500: HTTP API, UI, TCP only</li>
<li>8600: DNS Interface, TCP and UDP, handle DNS queries</li>
</ul>
<h2 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h2><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>3 or 5 server recommended. Start the Consul server with the following command on 3 or 5 servers.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">server \</span></div><div class="line">  -<span class="ruby">bootstrap-expect=<span class="number">3</span> \</span></div><div class="line">  -<span class="ruby">data-dir=<span class="regexp">/tmp/consul</span> \</span></div><div class="line">  -<span class="ruby">bind=&lt;ip&gt; \</span></div><div class="line">  -<span class="ruby">start_join=&lt;server1&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>Start the Consul client on every server that is part of the cluster with the following command.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">consul agent \</div><div class="line">  -<span class="ruby">data-dir=<span class="regexp">/tmp/consul</span> \</span></div><div class="line">  -<span class="ruby">bind=&lt;ip&gt; \</span></div><div class="line">  -<span class="ruby">start_join=&lt;server1,server2,server3&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="Health-Checks"><a href="#Health-Checks" class="headerlink" title="Health Checks"></a>Health Checks</h2><h3 id="Script-Interval"><a href="#Script-Interval" class="headerlink" title="Script + Interval"></a>Script + Interval</h3><p>Exit code of <code>0</code> will be treated as passing.<br>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"curl localhost &gt;/dev/null 2&gt;&amp;1"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"mem-util"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="HTTP-Interval"><a href="#HTTP-Interval" class="headerlink" title="HTTP + Interval"></a>HTTP + Interval</h3><p>Based on the http response code:</p>
<ul>
<li>2xx: passing</li>
<li>429 (Too Many Requests): warning</li>
<li>others: failure</li>
</ul>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"api"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"HTTP API on port 5000"</span>,</div><div class="line">    <span class="attr">"http"</span>: <span class="string">"http://localhost:5000/health"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="TCP-Interval"><a href="#TCP-Interval" class="headerlink" title="TCP + Interval"></a>TCP + Interval</h3><p>Checks if the tcp connection attemp is successful.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"ssh"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"SSH TCP on port 22"</span>,</div><div class="line">    <span class="attr">"tcp"</span>: <span class="string">"localhost:22"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"timeout"</span>: <span class="string">"1s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h3><p>Services report its status to Consul periodically over the HTTP, if no updates for the given TTL, the service will be marked as <code>cretical</code>.<br>Endpoint: <code>/v1/agent/check/pass/&lt;checkId&gt;</code></p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"web-app"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Web App Status"</span>,</div><div class="line">    <span class="attr">"notes"</span>: <span class="string">"Web app does a curl internally every 10 seconds"</span>,</div><div class="line">    <span class="attr">"ttl"</span>: <span class="string">"30s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Docker-Interval"><a href="#Docker-Interval" class="headerlink" title="Docker + Interval"></a>Docker + Interval</h3><p>Docker ported [Script + Interval]</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"check"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"mem-util"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">    <span class="attr">"docker_container_id"</span>: <span class="string">"f972c95ebf0e"</span>,</div><div class="line">    <span class="attr">"shell"</span>: <span class="string">"/bin/bash"</span>,</div><div class="line">    <span class="attr">"script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">    <span class="attr">"interval"</span>: <span class="string">"10s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Watches"><a href="#Watches" class="headerlink" title="Watches"></a>Watches</h2><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>Watch a specific KV pair.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"key"</span>,</div><div class="line">  <span class="attr">"key"</span>: <span class="string">"foo/bar/baz"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-key-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -<span class="built_in">type</span>=<span class="built_in">key</span> -<span class="built_in">key</span>=foo/<span class="built_in">bar</span>/baz /usr/bin/my-<span class="built_in">key</span>-handler.sh</div></pre></td></tr></table></figure>
<h3 id="keyprefix"><a href="#keyprefix" class="headerlink" title="keyprefix"></a>keyprefix</h3><p>Watch a prefix in the KV store.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"keyprefix"</span>,</div><div class="line">  <span class="attr">"prefix"</span>: <span class="string">"foo/"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-prefix-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -<span class="keyword">type</span>=keyprefix -<span class="keyword">prefix</span>=foo/ /usr/bin/my-<span class="keyword">prefix</span>-handler.sh</div></pre></td></tr></table></figure>
<h3 id="services"><a href="#services" class="headerlink" title="services"></a>services</h3><p>Watch the list of available services.</p>
<h3 id="nodes"><a href="#nodes" class="headerlink" title="nodes"></a>nodes</h3><p>Watch the list of nodes.</p>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>Watch the instances of a service.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"service"</span>,</div><div class="line">  <span class="attr">"service"</span>: <span class="string">"redis"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-service-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">consul</span> watch -<span class="keyword">type</span>=service -service=redis /usr/bin/my-service-handler.sh</div></pre></td></tr></table></figure>
<h3 id="checks"><a href="#checks" class="headerlink" title="checks"></a>checks</h3><p>Watch the value of health checks.</p>
<h3 id="event"><a href="#event" class="headerlink" title="event"></a>event</h3><p>Watch for custom user events.</p>
<p>Example:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span>: <span class="string">"event"</span>,</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"web-deploy"</span>,</div><div class="line">  <span class="attr">"handler"</span>: <span class="string">"/usr/bin/my-deploy-handler.sh"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul watch -type=event -<span class="built_in">name</span>=web-deploy /usr/bin/<span class="keyword">my</span>-deploy-handler.sh</div></pre></td></tr></table></figure>
<p>To fire a new <code>web-deploy</code> event:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">consul event -<span class="built_in">name</span>=web-deploy <span class="number">1609030</span></div></pre></td></tr></table></figure></p>
<h2 id="HTTP-API"><a href="#HTTP-API" class="headerlink" title="HTTP API"></a>HTTP API</h2><h3 id="ACLs"><a href="#ACLs" class="headerlink" title="ACLs"></a>ACLs</h3><h4 id="Create-ACL-Token"><a href="#Create-ACL-Token" class="headerlink" title="Create ACL Token"></a>Create ACL Token</h4><p>payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"my-app-token"</span>,</div><div class="line">  <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">  <span class="attr">"Rules"</span>: <span class="string">""</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ID</td>
<td>string</td>
<td>If not provided, a UUID is generated</td>
</tr>
<tr>
<td>Name</td>
<td>string</td>
<td>a human-friendly name for the ACL token</td>
</tr>
<tr>
<td>Type</td>
<td>string</td>
<td><code>client</code> (default) or <code>management</code></td>
</tr>
<tr>
<td>Rules</td>
<td>string</td>
<td>rules for this ACL token</td>
</tr>
</tbody>
</table>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="meta">@payload</span>.json <span class="string">http:</span><span class="comment">//localhost:8500/v1/acl/create</span></div></pre></td></tr></table></figure>
<h4 id="Update-ACL-Token"><a href="#Update-ACL-Token" class="headerlink" title="Update ACL Token"></a>Update ACL Token</h4><p>payload.json:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"adf4238a-882b-9ddc-4a9d-5b6758e4159e"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"my-app-token-updated"</span>,</div><div class="line">  <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">  <span class="attr">"Rules"</span>: <span class="string">"# New Rules"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="meta">@payload</span>.json <span class="string">http:</span><span class="comment">//localhost:8500/v1/acl/update</span></div></pre></td></tr></table></figure>
<h4 id="Delete-ACL-Token"><a href="#Delete-ACL-Token" class="headerlink" title="Delete ACL Token"></a>Delete ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http://localhost:<span class="number">8500</span>/v1/acl/destroy/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<h4 id="Read-ACL-Token"><a href="#Read-ACL-Token" class="headerlink" title="Read ACL Token"></a>Read ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/acl/destroy/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"CreateIndex"</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">"ModifyIndex"</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">"ID"</span>: <span class="string">"8f246b77-f3e1-ff88-5b48-8ec93abf3e05"</span>,</div><div class="line">    <span class="attr">"Name"</span>: <span class="string">"Client Token"</span>,</div><div class="line">    <span class="attr">"Type"</span>: <span class="string">"client"</span>,</div><div class="line">    <span class="attr">"Rules"</span>: <span class="string">"..."</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<h4 id="Clone-ACL-Token"><a href="#Clone-ACL-Token" class="headerlink" title="Clone ACL Token"></a>Clone ACL Token</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http://localhost:<span class="number">8500</span>/v1/acl/clone/8f246b77-f3e1-ff88-<span class="number">5b48</span>-8ec93abf3e05</div></pre></td></tr></table></figure>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"adf4238a-882b-9ddc-4a9d-5b6758e4159e"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Sample Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"service:redis"</span>: &#123;</div><div class="line">    <span class="attr">"Node"</span>: <span class="string">"foobar"</span>,</div><div class="line">    <span class="attr">"CheckID"</span>: <span class="string">"service:redis"</span>,</div><div class="line">    <span class="attr">"Name"</span>: <span class="string">"Service 'redis' check"</span>,</div><div class="line">    <span class="attr">"Status"</span>: <span class="string">"passing"</span>,</div><div class="line">    <span class="attr">"Notes"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"Output"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"ServiceID"</span>: <span class="string">"redis"</span>,</div><div class="line">    <span class="attr">"ServiceName"</span>: <span class="string">"redis"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="List-ACLs"><a href="#List-ACLs" class="headerlink" title="List ACLs"></a>List ACLs</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>acl<span class="regexp">/list</span></div></pre></td></tr></table></figure>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><p>From the local Consul agent’s point of view, might be different from other agents.</p>
<h4 id="List-Members"><a href="#List-Members" class="headerlink" title="List Members"></a>List Members</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/members</span></div></pre></td></tr></table></figure>
<h4 id="Read-Conf"><a href="#Read-Conf" class="headerlink" title="Read Conf"></a>Read Conf</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/self</span></div></pre></td></tr></table></figure>
<h4 id="Reload"><a href="#Reload" class="headerlink" title="Reload"></a>Reload</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/reload</span></div></pre></td></tr></table></figure>
<h4 id="Enable-Maintenance-Mode"><a href="#Enable-Maintenance-Mode" class="headerlink" title="Enable Maintenance Mode"></a>Enable Maintenance Mode</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/maintenance?enable=true&amp;reason=Upgration</span></div></pre></td></tr></table></figure>
<h4 id="Stream-Logs"><a href="#Stream-Logs" class="headerlink" title="Stream Logs"></a>Stream Logs</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/monitor</span></div></pre></td></tr></table></figure>
<h4 id="Join-Agent"><a href="#Join-Agent" class="headerlink" title="Join Agent"></a>Join Agent</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/join/</span>:address</div></pre></td></tr></table></figure>
<h4 id="Graceful-Leave"><a href="#Graceful-Leave" class="headerlink" title="Graceful Leave"></a>Graceful Leave</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/leave</span></div></pre></td></tr></table></figure>
<h4 id="Force-Leave"><a href="#Force-Leave" class="headerlink" title="Force Leave"></a>Force Leave</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/force-leave</span></div></pre></td></tr></table></figure>
<h3 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h3><p>Operating on <code>Check</code> by <code>agent</code> API.</p>
<h4 id="List-Checks"><a href="#List-Checks" class="headerlink" title="List Checks"></a>List Checks</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/checks</span></div></pre></td></tr></table></figure>
<h4 id="Register-Check"><a href="#Register-Check" class="headerlink" title="Register Check"></a>Register Check</h4><p>Sample payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"mem"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"Memory utilization"</span>,</div><div class="line">  <span class="attr">"Notes"</span>: <span class="string">"Ensure we don't oversubscribe memory"</span>,</div><div class="line">  <span class="attr">"DeregisterCriticalServiceAfter"</span>: <span class="string">"90m"</span>,</div><div class="line">  <span class="attr">"Script"</span>: <span class="string">"/usr/local/bin/check_mem.py"</span>,</div><div class="line">  <span class="attr">"DockerContainerID"</span>: <span class="string">"f972c95ebf0e"</span>,</div><div class="line">  <span class="attr">"Shell"</span>: <span class="string">"/bin/bash"</span>,</div><div class="line">  <span class="attr">"HTTP"</span>: <span class="string">"http://example.com"</span>,</div><div class="line">  <span class="attr">"TCP"</span>: <span class="string">"example.com:22"</span>,</div><div class="line">  <span class="attr">"Interval"</span>: <span class="string">"10s"</span>,</div><div class="line">  <span class="attr">"TTL"</span>: <span class="string">"15s"</span>,</div><div class="line">  <span class="attr">"TLSSkipVerify"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d @payload.json http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>register</div></pre></td></tr></table></figure>
<h4 id="Deregister-Check"><a href="#Deregister-Check" class="headerlink" title="Deregister Check"></a>Deregister Check</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>deregister<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Pass"><a href="#TTL-Check-Pass" class="headerlink" title="TTL Check Pass"></a>TTL Check Pass</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>pass<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Warn"><a href="#TTL-Check-Warn" class="headerlink" title="TTL Check Warn"></a>TTL Check Warn</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>warn<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h4 id="TTL-Check-Fail"><a href="#TTL-Check-Fail" class="headerlink" title="TTL Check Fail"></a>TTL Check Fail</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/check/</span>fail<span class="regexp">/:check_id</span></div></pre></td></tr></table></figure>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>Operating on <code>Check</code> by <code>agent</code> API.</p>
<h4 id="List-Services"><a href="#List-Services" class="headerlink" title="List Services"></a>List Services</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/services</span></div></pre></td></tr></table></figure>
<h3 id="Register-Service"><a href="#Register-Service" class="headerlink" title="Register Service"></a>Register Service</h3><p>Sample payload.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ID"</span>: <span class="string">"redis1"</span>,</div><div class="line">  <span class="attr">"Name"</span>: <span class="string">"redis"</span>,</div><div class="line">  <span class="attr">"Tags"</span>: [</div><div class="line">    <span class="string">"primary"</span>,</div><div class="line">    <span class="string">"v1"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"Address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">  <span class="attr">"Port"</span>: <span class="number">8000</span>,</div><div class="line">  <span class="attr">"EnableTagOverride"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">"Check"</span>: &#123;</div><div class="line">    <span class="attr">"DeregisterCriticalServiceAfter"</span>: <span class="string">"90m"</span>,</div><div class="line">    <span class="attr">"Script"</span>: <span class="string">"/usr/local/bin/check_redis.py"</span>,</div><div class="line">    <span class="attr">"HTTP"</span>: <span class="string">"http://localhost:5000/health"</span>,</div><div class="line">    <span class="attr">"Interval"</span>: <span class="string">"10s"</span>,</div><div class="line">    <span class="attr">"TTL"</span>: <span class="string">"15s"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d @payload.json http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/service/</span>register</div></pre></td></tr></table></figure>
<h4 id="Deregister-Service"><a href="#Deregister-Service" class="headerlink" title="Deregister Service"></a>Deregister Service</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>agent<span class="regexp">/service/</span>deregister<span class="regexp">/:service_id</span></div></pre></td></tr></table></figure>
<h4 id="Enable-Maintenance-Mode-1"><a href="#Enable-Maintenance-Mode-1" class="headerlink" title="Enable Maintenance Mode"></a>Enable Maintenance Mode</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/agent/service/maintenance/<span class="symbol">:service_id?enable=true&amp;reason=Upgration</span></div></pre></td></tr></table></figure>
<h3 id="Catelog"><a href="#Catelog" class="headerlink" title="Catelog"></a>Catelog</h3><p><a href="https://www.consul.io/api/catalog.html" target="_blank" rel="external">https://www.consul.io/api/catalog.html</a></p>
<h4 id="List-DataCenters"><a href="#List-DataCenters" class="headerlink" title="List DataCenters"></a>List DataCenters</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/datacenters</span></div></pre></td></tr></table></figure>
<h4 id="List-Services-1"><a href="#List-Services-1" class="headerlink" title="List Services"></a>List Services</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/services</span></div></pre></td></tr></table></figure>
<h4 id="List-Nodes-for-Service"><a href="#List-Nodes-for-Service" class="headerlink" title="List Nodes for Service"></a>List Nodes for Service</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>catalog<span class="regexp">/service/</span>:service</div></pre></td></tr></table></figure>
<h4 id="List-Services-for-Node"><a href="#List-Services-for-Node" class="headerlink" title="List Services for Node"></a>List Services for Node</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/catalog/<span class="keyword">node</span><span class="title">/:node</span></div></pre></td></tr></table></figure>
<h3 id="Health"><a href="#Health" class="headerlink" title="Health"></a>Health</h3><h4 id="Critical-Service"><a href="#Critical-Service" class="headerlink" title="Critical Service"></a>Critical Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/critical</div></pre></td></tr></table></figure>
<h4 id="Passing-Service"><a href="#Passing-Service" class="headerlink" title="Passing Service"></a>Passing Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/passing</div></pre></td></tr></table></figure>
<h4 id="Warning-Service"><a href="#Warning-Service" class="headerlink" title="Warning Service"></a>Warning Service</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:<span class="number">8500</span>/v1/health/<span class="keyword">state</span>/warning</div></pre></td></tr></table></figure>
<h3 id="KV-Store"><a href="#KV-Store" class="headerlink" title="KV Store"></a>KV Store</h3><h4 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/kv/<span class="symbol">:key</span></div><div class="line">curl <span class="symbol">http:</span>/<span class="regexp">/localhost:8500/v</span>1/kv/<span class="symbol">:key?recurse=true</span></div></pre></td></tr></table></figure>
<h4 id="Create-Update-Key"><a href="#Create-Update-Key" class="headerlink" title="Create/Update Key"></a>Create/Update Key</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -X PUT -d <span class="string">"value"</span> http:<span class="regexp">//</span>localhost:<span class="number">8500</span><span class="regexp">/v1/</span>kv<span class="regexp">/:key</span></div></pre></td></tr></table></figure>
<h4 id="Delete-Key"><a href="#Delete-Key" class="headerlink" title="Delete Key"></a>Delete Key</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -X <span class="keyword">DELETE</span> <span class="keyword">http</span>://localhost:<span class="number">8500</span>/v1/kv/:<span class="keyword">key</span></div><div class="line">curl -X <span class="keyword">DELETE</span> <span class="keyword">http</span>://localhost:<span class="number">8500</span>/v1/kv/:<span class="keyword">key</span>?recurse=<span class="literal">true</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Installation&quot;&gt;&lt;a href=&quot;#Installation&quot; class=&quot;headerlink&quot; title=&quot;Installation&quot;&gt;&lt;/a&gt;Installation&lt;/h2&gt;&lt;p&gt;Download package from &lt;a href=
    
    </summary>
    
    
      <category term="service registry" scheme="http://www.orctom.com/tags/service-registry/"/>
    
      <category term="service discovery" scheme="http://www.orctom.com/tags/service-discovery/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch</title>
    <link href="http://www.orctom.com/2017/05/16/elasticsearch/"/>
    <id>http://www.orctom.com/2017/05/16/elasticsearch/</id>
    <published>2017-05-16T15:42:02.000Z</published>
    <updated>2017-08-15T07:40:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Terms"><a href="#Terms" class="headerlink" title="Terms"></a>Terms</h2><h3 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank" rel="external">https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html</a></p>
<table>
<thead>
<tr>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text</code></td>
<td><ul><li>Analyzed to lists of terms</li><li>For full-text search</li><li>Not for sorting, aggregation</li></ul></td>
</tr>
<tr>
<td><code>keyword</code></td>
<td><ul><li>For filtring</li><li>Only searchable by exact value</li></ul></td>
</tr>
<tr>
<td><code>date</code></td>
<td>“format”: “yyyy-MM-dd HH:mm:ss</td>
<td></td>
<td>yyyy-MM-dd</td>
<td></td>
<td>epoch_millis”</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td></td>
</tr>
<tr>
<td><code>binary</code></td>
<td><ul><li>Not searchable</li><li><code>Base64</code> encoded string</li></ul></td>
</tr>
<tr>
<td><code>long</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>integer</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>short</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>byte</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>double</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>float</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>half_float</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>scaled_float</code></td>
<td>numeric</td>
</tr>
<tr>
<td><code>integer_range</code></td>
<td>range</td>
</tr>
<tr>
<td><code>long_range</code></td>
<td>range</td>
</tr>
<tr>
<td><code>double_range</code></td>
<td>range</td>
</tr>
<tr>
<td><code>date_range</code></td>
<td>range</td>
</tr>
<tr>
<td><code>ip_range</code></td>
<td>range</td>
</tr>
<tr>
<td><code>geo_point</code></td>
<td><ul><li>bounding box</li><li>polygon</li></ul></td>
</tr>
<tr>
<td><code>geo_shape</code></td>
<td>arbitrary geo shapes such as rectangles and polygons</td>
</tr>
<tr>
<td><code>ip</code></td>
<td>Supports <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation" target="_blank" rel="external">CIDR_notation</a></td>
</tr>
</tbody>
</table>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>To register Analyzers, Tokenizers and TokenFilters</p>
<p>Sample:<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">index :</div><div class="line">  <span class="type">analysis</span> :</div><div class="line">    <span class="type">analyzer</span> :</div><div class="line">      <span class="type">standard</span> :</div><div class="line">        <span class="type">type</span> : <span class="type">standard</span></div><div class="line">        stopwords : [<span class="type">stop1</span>, stop2]</div><div class="line">      myAnalyzer1 :</div><div class="line">        <span class="type">type</span> : <span class="type">standard</span></div><div class="line">        stopwords : [<span class="type">stop1</span>, stop2, stop3]</div><div class="line">        max_token_length : 500</div><div class="line">      # configure a custom analyzer which <span class="keyword">is</span></div><div class="line">      # exactly like the default standard analyzer</div><div class="line">      myAnalyzer2 :</div><div class="line">        <span class="type">tokenizer</span> : <span class="type">standard</span></div><div class="line">        filter : [<span class="type">standard</span>, lowercase, stop]</div><div class="line">    tokenizer :</div><div class="line">      <span class="type">myTokenizer1</span> :</div><div class="line">        <span class="type">type</span> : <span class="type">standard</span></div><div class="line">        max_token_length : 900</div><div class="line">      myTokenizer2 :</div><div class="line">        <span class="type">type</span> : <span class="type">keyword</span></div><div class="line">        buffer_size : 512</div><div class="line">    filter :</div><div class="line">      <span class="type">myTokenFilter1</span> :</div><div class="line">        <span class="type">type</span> : <span class="type">stop</span></div><div class="line">        stopwords : [<span class="type">stop1</span>, stop2, stop3, stop4]</div><div class="line">      myTokenFilter2 :</div><div class="line">        <span class="type">type</span> : <span class="type">length</span></div><div class="line">        min : 0</div><div class="line">        max : 2000</div></pre></td></tr></table></figure></p>
<h4 id="Analyzer"><a href="#Analyzer" class="headerlink" title="Analyzer"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer.html" target="_blank" rel="external">Analyzer</a></h4><p>/Tokennizer{1} + TokenFilter*/</p>
<p>Predefined tokenizers, token filters and character filters to configure custome analyzers.</p>
<p><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" target="_blank" rel="external">Built-in analyzers</a></strong></p>
<ul>
<li>Standard Analyzer</li>
<li>Simple Analyzer</li>
<li>Whitespace Analyzer</li>
<li>Stop Analyzer</li>
<li>Keyword Analyzer</li>
<li>Pattern Analyzer</li>
<li>Language Analyzers</li>
<li>Snowball Analyzer</li>
<li>Custom Analyzer</li>
</ul>
<h4 id="Tokenizer"><a href="#Tokenizer" class="headerlink" title="Tokenizer"></a>Tokenizer</h4><h4 id="Token-Filter"><a href="#Token-Filter" class="headerlink" title="Token Filter"></a>Token Filter</h4><ul>
<li>Standard </li>
<li>ASCII Folding </li>
<li>Length </li>
<li>Lowercase </li>
<li>Uppercase </li>
<li>NGram </li>
<li>Edge NGram </li>
<li>Porter Stem </li>
<li>Shingle </li>
<li>Stop </li>
<li>Word Delimiter </li>
<li>Stemmer </li>
<li>Stemmer Override </li>
<li>Keyword Marker </li>
<li>Keyword Repeat </li>
<li>KStem </li>
<li>Snowball </li>
<li>Phonetic </li>
<li>Synonym </li>
<li>Compound Word </li>
<li>Reverse </li>
<li>Elision </li>
<li>Truncate </li>
<li>Unique </li>
<li>Pattern Capture </li>
<li>Pattern Replace </li>
<li>Trim </li>
<li>Limit Token Count </li>
<li>Hunspell </li>
<li>Common Grams </li>
<li>Normalization </li>
<li>CJK Width </li>
<li>CJK Bigram </li>
<li>Delimited Payload </li>
<li>Keep Words </li>
<li>Keep Types </li>
<li>Classic </li>
<li>Apostrophe </li>
<li>Decimal Digit </li>
</ul>
<h4 id="Character-Filter"><a href="#Character-Filter" class="headerlink" title="Character Filter"></a>Character Filter</h4><hr>
<h2 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h2><h3 id="Query-API"><a href="#Query-API" class="headerlink" title="Query API"></a>Query API</h3><h4 id="Basic-Query-String"><a href="#Basic-Query-String" class="headerlink" title="Basic Query String"></a>Basic Query String</h4><ul>
<li>{endpoint}/_search?q=hello&amp;size=5</li>
</ul>
<p>Ref:</p>
<ul>
<li><a href="http://lucene.apache.org/core/old_versioned_docs/versions/3_0_0/queryparsersyntax.html" target="_blank" rel="external">Lucene query parser syntax</a></li>
<li><a href="http://www.elasticsearch.org/guide/reference/api/search/uri-request.html" target="_blank" rel="external">ElasticSearch URI request docs</a></li>
</ul>
<h4 id="Full-Query-API"><a href="#Full-Query-API" class="headerlink" title="Full Query API"></a>Full Query API</h4><ul>
<li>{endpoint}/_search?source={Query-as-JSON}</li>
<li>curl -XGET {endpoint}/_search -d ‘Query-as-JSON’</li>
</ul>
<h4 id="Query-Language"><a href="#Query-Language" class="headerlink" title="Query Language"></a>Query Language</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  size: <span class="string">"number of results to return (defaults to 10)"</span>,</div><div class="line">  from: <span class="string">"offset into results (defaults to 0)"</span>,</div><div class="line">  field<span class="variable">s:</span> <span class="string">"list of document fields that should be returned - http://elasticsearch.org/guide/reference/api/search/fields.html"</span>,</div><div class="line">  <span class="keyword">sor</span><span class="variable">t:</span> <span class="string">"define sort order - see http://elasticsearch.org/guide/reference/api/search/sort.html"</span>,</div><div class="line"></div><div class="line">  query: &#123;</div><div class="line">    </div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  facet<span class="variable">s:</span> &#123;</div><div class="line">    # facets specifications</div><div class="line">    # Facets provide summary information about <span class="keyword">a</span> particular field <span class="built_in">or</span> fields in the data</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  # special case <span class="keyword">for</span> situations where you want <span class="keyword">to</span> apply <span class="built_in">filter</span>/query <span class="keyword">to</span> results but *not* <span class="keyword">to</span> facets</div><div class="line">  <span class="built_in">filter</span>: &#123;</div><div class="line">    # <span class="built_in">filter</span> objects</div><div class="line">    # <span class="keyword">a</span> <span class="built_in">filter</span> <span class="keyword">is</span> <span class="keyword">a</span> simple <span class="string">"filter"</span> (query) <span class="keyword">on</span> <span class="keyword">a</span> specific field.</div><div class="line">    # Simple means <span class="keyword">e</span>.g. checking against <span class="keyword">a</span> specific value <span class="built_in">or</span> <span class="built_in">range</span> of <span class="built_in">values</span></div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><ul>
<li>Query Context: How well does this document match this query clause?</li>
<li>Filter Context: Does this document match this query clause?</li>
</ul>
<hr>
<h3 id="Query-Cateories"><a href="#Query-Cateories" class="headerlink" title="Query Cateories"></a>Query Cateories</h3><ul>
<li>Leaf query clauses<ul>
<li>match</li>
<li>term</li>
<li>range</li>
</ul>
</li>
<li>Compound query clauses<ul>
<li>not</li>
<li>bool</li>
<li>dis_max</li>
<li>constant_score</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Query-Types"><a href="#Query-Types" class="headerlink" title="Query Types"></a>Query Types</h3><h4 id="Match-All-Query"><a href="#Match-All-Query" class="headerlink" title="Match All Query"></a>Match All Query</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"match_all"</span>: &#123; <span class="attr">"boost"</span> : <span class="number">1.2</span> &#125;&#125;</div></pre></td></tr></table></figure>
<h4 id="Full-Text-Queries"><a href="#Full-Text-Queries" class="headerlink" title="Full Text Queries"></a>Full Text Queries</h4><h5 id="Match-Query"><a href="#Match-Query" class="headerlink" title="Match Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="external">Match Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"match"</span> : &#123;</div><div class="line">    <span class="attr">"field_name"</span> : <span class="string">"the query"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"match"</span> : &#123;</div><div class="line">    <span class="attr">"message"</span> : &#123;</div><div class="line">      <span class="attr">"query"</span> : <span class="string">"the query"</span>,</div><div class="line">      <span class="attr">"operator"</span> : <span class="string">"and"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Supported parameters:</p>
<ul>
<li>analyzer</li>
<li>boost</li>
<li>operator</li>
<li>minimum_should_match</li>
<li>fuzziness</li>
<li>prefix_length</li>
<li>max_expansions</li>
<li>rewrite</li>
<li>zero_terms_query </li>
<li>cutoff_frequency</li>
</ul>
<h6 id="boolean-default"><a href="#boolean-default" class="headerlink" title="boolean (default)"></a>boolean (default)</h6><ul>
<li>fuzziness</li>
<li>zero_terms_query</li>
<li>cutoff_frequency<ul>
<li>relative: [0..1), absolute: 1.0..infinite</li>
<li>per-shard-level</li>
</ul>
</li>
</ul>
<h6 id="phrase"><a href="#phrase" class="headerlink" title="phrase"></a>phrase</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"match_phrase"</span> : &#123;</div><div class="line">    <span class="attr">"message"</span> : <span class="string">"this is a test"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"match"</span> : &#123;</div><div class="line">    <span class="attr">"message"</span> : &#123;</div><div class="line">      <span class="attr">"query"</span> : <span class="string">"this is a test"</span>,</div><div class="line">      <span class="attr">"type"</span> : <span class="string">"phrase"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="phrase-prefix"><a href="#phrase-prefix" class="headerlink" title="phrase_prefix"></a>phrase_prefix</h6><p>Same as match_phrase, except that it allows for prefix matches on the last term in the text.</p>
<hr>
<h5 id="Multi-match-Query"><a href="#Multi-match-Query" class="headerlink" title="Multi-match Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" target="_blank" rel="external">Multi-match Query</a></h5><p>Multi-field queires.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"multi_match"</span> : &#123;</div><div class="line">    <span class="attr">"query"</span>:    <span class="string">"this is a test"</span>, </div><div class="line">    <span class="attr">"fields"</span>: [ <span class="string">"subject^3"</span>, <span class="string">"message"</span>, <span class="string">"*_name"</span> ] </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Types:</p>
<ul>
<li>best_fields: (default) any fields with best <code>_score</code></li>
<li>most_fields: any fields and conbines the <code>_score</code></li>
<li>cross_fields:  aggs fields of same <code>analyzer</code></li>
<li>phrase: run <code>match_phrase</code> query on each field and conbines <code>_score</code></li>
<li>phrase_prefix: similar with <code>phrase</code></li>
</ul>
<h5 id="Common-terms-Query"><a href="#Common-terms-Query" class="headerlink" title="Common_terms Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-common-terms-query.html" target="_blank" rel="external">Common_terms Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"common"</span>: &#123;</div><div class="line">    <span class="attr">"body"</span>: &#123;</div><div class="line">      <span class="attr">"query"</span>: <span class="string">"nelly the elephant as a cartoon"</span>,</div><div class="line">      <span class="attr">"cutoff_frequency"</span>: <span class="number">0.001</span>,</div><div class="line">      <span class="attr">"minimum_should_match"</span>: <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"common"</span>: &#123;</div><div class="line">    <span class="attr">"body"</span>: &#123;</div><div class="line">      <span class="attr">"query"</span>: <span class="string">"nelly the elephant not as a cartoon"</span>,</div><div class="line">      <span class="attr">"cutoff_frequency"</span>: <span class="number">0.001</span>,</div><div class="line">      <span class="attr">"minimum_should_match"</span>: &#123;</div><div class="line">          <span class="attr">"low_freq"</span> : <span class="number">2</span>,</div><div class="line">          <span class="attr">"high_freq"</span> : <span class="number">3</span></div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Query-String-Query"><a href="#Query-String-Query" class="headerlink" title="Query String Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="external">Query String Query</a></h5><p>Full-text style query across all fields(<code>default_field</code> defaults to <code>_all</code>).<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query_string"</span> : &#123;</div><div class="line">    <span class="attr">"default_field"</span> : <span class="string">"content"</span>,</div><div class="line">    <span class="attr">"query"</span> : <span class="string">"this AND that OR thus"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query_string"</span> : &#123;</div><div class="line">    <span class="attr">"fields"</span> : [<span class="string">"content"</span>, <span class="string">"name"</span>],</div><div class="line">    <span class="attr">"query"</span> : <span class="string">"this AND that"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Parameter:</p>
<ul>
<li>query</li>
<li>default_field (_all)</li>
<li>default_operator (OR)</li>
<li>analyzer</li>
<li>allow_leading_wildcard (true)</li>
<li>lowercase_expanded_terms (wildcard, prefix, fuzzy, and range queries) (true)</li>
<li>enable_position_increments (true)</li>
<li>fuzzy_max_expansions (50)</li>
<li>fuzziness (AUTO)</li>
<li>fuzzy_prefix_length (0)</li>
<li>phrase_slop (0)</li>
<li>boost (1.0)</li>
<li>analyze_wildcard (false)</li>
<li>auto_generate_phrase_queries (false)</li>
<li>max_determinized_states (10000)</li>
<li>minimum_should_match</li>
<li>lenient (false)</li>
<li>locale (ROOT)</li>
<li>time_zone []Joda timezone(<a href="http://www.joda.org/joda-time/apidocs/org/joda/time/DateTimeZone.html" target="_blank" rel="external">http://www.joda.org/joda-time/apidocs/org/joda/time/DateTimeZone.html</a>)</li>
</ul>
<h5 id="Simple-Query-String-Query"><a href="#Simple-Query-String-Query" class="headerlink" title="Simple Query String Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="external">Simple Query String Query</a></h5><p>Never throw an exception, and discards invalid parts of the query.</p>
<h4 id="Term-Level-Queries"><a href="#Term-Level-Queries" class="headerlink" title="Term Level Queries"></a>Term Level Queries</h4><h5 id="Term-Query"><a href="#Term-Query" class="headerlink" title="Term Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="external">Term Query</a></h5><p>Finds documents which contain the exact term <code>Kimchy</code> in the inverted index of the <code>user</code> field.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"Kimchy"</span> &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Optional <code>boost</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query"</span>: &#123;</div><div class="line">    <span class="attr">"bool"</span>: &#123;</div><div class="line">      <span class="attr">"should"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"term"</span>: &#123;</div><div class="line">            <span class="attr">"status"</span>: &#123;</div><div class="line">              <span class="attr">"value"</span>: <span class="string">"urgent"</span>,</div><div class="line">              <span class="attr">"boost"</span>: <span class="number">2.0</span> </div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"term"</span>: &#123;</div><div class="line">            <span class="attr">"status"</span>: <span class="string">"normal"</span> </div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Terms-Query"><a href="#Terms-Query" class="headerlink" title="Terms Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="external">Terms Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"constant_score"</span> : &#123;</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"terms"</span> : &#123; <span class="attr">"user"</span> : [<span class="string">"kimchy"</span>, <span class="string">"elasticsearch"</span>]&#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Range-Query"><a href="#Range-Query" class="headerlink" title="Range Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="external">Range Query</a></h5><ul>
<li>TermRangeQuery (string)</li>
<li>NumericRangeQuery (number/date)<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"range"</span> : &#123;</div><div class="line">    <span class="attr">"age"</span> : &#123;</div><div class="line">      <span class="attr">"gte"</span> : <span class="number">10</span>,</div><div class="line">      <span class="attr">"lte"</span> : <span class="number">20</span>,</div><div class="line">      <span class="attr">"boost"</span> : <span class="number">2.0</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#date-math" target="_blank" rel="external">Date Math</a>:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"range"</span> : &#123;</div><div class="line">    <span class="attr">"date"</span> : &#123;</div><div class="line">      <span class="attr">"gte"</span> : <span class="string">"now-1d/d"</span>,</div><div class="line">      <span class="attr">"lt"</span> :  <span class="string">"now/d"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Date format &amp; time zone:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"range"</span> : &#123;</div><div class="line">    <span class="attr">"born"</span> : &#123;</div><div class="line">      <span class="attr">"gte"</span>: <span class="string">"01/01/2012"</span>,</div><div class="line">      <span class="attr">"lte"</span>: <span class="string">"2013"</span>,</div><div class="line">      <span class="attr">"format"</span>: <span class="string">"dd/MM/yyyy||yyyy"</span>,</div><div class="line">      <span class="attr">"time_zone"</span>: <span class="string">"-04:00"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Parameters:</p>
<ul>
<li>gte: Greater-than or equal to</li>
<li>gt: Greater-than</li>
<li>lte: Less-than or equal to</li>
<li>lt: Less-than</li>
<li>boost: Sets the boost value of the query, defaults to 1.0</li>
</ul>
<h5 id="Exists-Query"><a href="#Exists-Query" class="headerlink" title="Exists Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="external">Exists Query</a></h5><p>Returns documents that have at least one non-null value in the original field.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"exists"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"user"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Missing-Query"><a href="#Missing-Query" class="headerlink" title="Missing Query"></a>Missing Query</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="string">"bool"</span>: &#123;</div><div class="line">  <span class="string">"must_not"</span>: &#123;</div><div class="line">    <span class="string">"exists"</span>: &#123;</div><div class="line">      <span class="string">"field"</span>: <span class="string">"user"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Prefix-Query"><a href="#Prefix-Query" class="headerlink" title="Prefix Query"></a>Prefix Query</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Optional boost:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> :  &#123; <span class="attr">"value"</span> : <span class="string">"ki"</span>, <span class="attr">"boost"</span> : <span class="number">2.0</span> &#125; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Wildcard-Query"><a href="#Wildcard-Query" class="headerlink" title="Wildcard Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="external">Wildcard Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"wildcard"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki*y"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Optional boost:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"wildcard"</span> : &#123; <span class="attr">"user"</span> : &#123; <span class="attr">"value"</span> : <span class="string">"ki*y"</span>, <span class="attr">"boost"</span> : <span class="number">2.0</span> &#125; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Regexp-Query"><a href="#Regexp-Query" class="headerlink" title="Regexp Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="external">Regexp Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"regexp"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki.*y"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Optional boost:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"regexp"</span> : &#123; <span class="attr">"user"</span> : &#123; <span class="attr">"value"</span> : <span class="string">"ki.*y"</span>, <span class="attr">"boost"</span> : <span class="number">2.0</span> &#125; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Fuzzy-Query"><a href="#Fuzzy-Query" class="headerlink" title="Fuzzy Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="external">Fuzzy Query</a></h5><ul>
<li>Levenshtein edit distance for string</li>
<li>+/- margin on numeric and date</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"fuzzy"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"fuzzy"</span> : &#123;</div><div class="line">    <span class="attr">"user"</span> : &#123;</div><div class="line">      <span class="attr">"value"</span> :         <span class="string">"ki"</span>,</div><div class="line">      <span class="attr">"boost"</span> :         <span class="number">1.0</span>,</div><div class="line">      <span class="attr">"fuzziness"</span> :     <span class="number">2</span>,</div><div class="line">      <span class="attr">"prefix_length"</span> : <span class="number">0</span>,</div><div class="line">      <span class="attr">"max_expansions"</span>: <span class="number">100</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"fuzzy"</span> : &#123;</div><div class="line">    <span class="attr">"price"</span> : &#123;</div><div class="line">      <span class="attr">"value"</span> : <span class="number">12</span>,</div><div class="line">      <span class="attr">"fuzziness"</span> : <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"fuzzy"</span> : &#123;</div><div class="line">    <span class="attr">"created"</span> : &#123;</div><div class="line">      <span class="attr">"value"</span> : <span class="string">"2010-02-05T12:05:07"</span>,</div><div class="line">      <span class="attr">"fuzziness"</span> : <span class="string">"1d"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Parameters:</p>
<ul>
<li>fuzziness: The maximum edit distance. Defaults to <code>AUTO</code>.</li>
<li>prefix_length: The number of initial characters which will not be “fuzzified”. This helps to reduce the number of terms which must be examined. Defaults to 0.</li>
<li>max_expansions: The maximum number of terms that the fuzzy query will expand to. Defaults to 50.</li>
</ul>
<h5 id="Type-Query"><a href="#Type-Query" class="headerlink" title="Type Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="external">Type Query</a></h5><p>Matching the provided document / mapping type.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type"</span> : &#123;</div><div class="line">    <span class="attr">"value"</span> : <span class="string">"my_type"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="IDs-Query"><a href="#IDs-Query" class="headerlink" title="IDs Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="external">IDs Query</a></h5><p>Filters documents that only have the provided <code>_uid</code>.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"ids"</span> : &#123;</div><div class="line">    <span class="attr">"type"</span> : <span class="string">"my_type"</span>,</div><div class="line">    <span class="attr">"values"</span> : [<span class="string">"1"</span>, <span class="string">"4"</span>, <span class="string">"100"</span>]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="Compound-Queries"><a href="#Compound-Queries" class="headerlink" title="Compound Queries"></a>Compound Queries</h4><h5 id="Constant-Score-query"><a href="#Constant-Score-query" class="headerlink" title="Constant Score query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-constant-score-query.html" target="_blank" rel="external">Constant Score query</a></h5><p>A query that wraps another query and simply returns a constant score equal to the query boost for every document in the filter. Maps to Lucene ConstantScoreQuery.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"constant_score"</span> : &#123;</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span>&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"boost"</span> : <span class="number">1.2</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Bool-Query"><a href="#Bool-Query" class="headerlink" title="Bool Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" target="_blank" rel="external">Bool Query</a></h5><p>Occurrence types:</p>
<ul>
<li>must: The clause (query) must appear in matching documents and will contribute to the score.</li>
<li>filter: The clause (query) must appear in matching documents. the score of the query will be ignored.</li>
<li>should: The clause (query) should appear in the matching document. In a boolean query with no must clauses, one or more should clauses must match a document, the minimum number of should clauses to match can be set using the minimum_should_match parameter.</li>
<li>must_not: The clause (query) must not appear in the matching documents.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span> : &#123;</div><div class="line">    <span class="attr">"must"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span>: &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"tech"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"must_not"</span> : &#123;</div><div class="line">      <span class="attr">"range"</span> : &#123;</div><div class="line">        <span class="attr">"age"</span> : &#123; <span class="attr">"from"</span> : <span class="number">10</span>, <span class="attr">"to"</span> : <span class="number">20</span> &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"should"</span> : [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"wow"</span> &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"elasticsearch"</span> &#125;</div><div class="line">      &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">"minimum_should_match"</span> : <span class="number">1</span>,</div><div class="line">    <span class="attr">"boost"</span> : <span class="number">1.0</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Dis-Max-Query"><a href="#Dis-Max-Query" class="headerlink" title="Dis Max Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-dis-max-query.html" target="_blank" rel="external">Dis Max Query</a></h5><p>Generates the union of documents produced by its subqueries, an dscores each document with the maximum score for that document as produced by any subquery, plus a tie breaking increment for any additional matching subqueries.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"dis_max"</span> : &#123;</div><div class="line">    <span class="attr">"tie_breaker"</span> : <span class="number">0.7</span>,</div><div class="line">    <span class="attr">"boost"</span> : <span class="number">1.2</span>,</div><div class="line">    <span class="attr">"queries"</span> : [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">34</span> &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">35</span> &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Function-Score-Query"><a href="#Function-Score-Query" class="headerlink" title="Function Score Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html" target="_blank" rel="external">Function Score Query</a></h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="string">"function_score"</span>: &#123;</div><div class="line">  <span class="string">"query"</span>: &#123;&#125;,</div><div class="line">  <span class="string">"boost"</span>: <span class="string">"boost for the whole query"</span>,</div><div class="line">  <span class="string">"FUNCTION"</span>: &#123;&#125;, </div><div class="line">  <span class="string">"boost_mode"</span>:<span class="string">"(multiply|replace|...)"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="string">"function_score"</span>: &#123;</div><div class="line">  <span class="string">"query"</span>: &#123;&#125;,</div><div class="line">  <span class="string">"boost"</span>: <span class="string">"boost for the whole query"</span>,</div><div class="line">  <span class="string">"functions"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="string">"filter"</span>: &#123;&#125;,</div><div class="line">      <span class="string">"FUNCTION"</span>: &#123;&#125;, </div><div class="line">      <span class="string">"weight"</span>: number</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="string">"FUNCTION"</span>: &#123;&#125; </div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="string">"filter"</span>: &#123;&#125;,</div><div class="line">      <span class="string">"weight"</span>: number</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  <span class="string">"max_boost"</span>: number,</div><div class="line">  <span class="string">"score_mode"</span>: <span class="string">"(multiply|max|...)"</span>,</div><div class="line">  <span class="string">"boost_mode"</span>: <span class="string">"(multiply|replace|...)"</span>,</div><div class="line">  <span class="string">"min_score"</span> : number</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>score_mode:</p>
<ul>
<li><code>multiply</code>: scores are multiplied (default)</li>
<li><code>sum</code>: scores are summed</li>
<li><code>avg</code>: scores are averaged</li>
<li><code>first</code>: the first function that has a matching filter is applied</li>
<li><code>max</code>: maximum score is used</li>
<li><code>min</code>: minimum score is used</li>
</ul>
<p>boost_mode:</p>
<ul>
<li><code>multiply</code>: query score and function score is multiplied (default)</li>
<li><code>replace</code>: only function score is used, the query score is ignored</li>
<li><code>sum</code>: query score and function score are added</li>
<li><code>avg</code>: average</li>
<li><code>max</code>: max of query score and function score</li>
<li><code>min</code>: min of query score and function score</li>
</ul>
<h5 id="Boosting-Query"><a href="#Boosting-Query" class="headerlink" title="Boosting Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-boosting-query.html" target="_blank" rel="external">Boosting Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"boosting"</span> : &#123;</div><div class="line">    <span class="attr">"positive"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123;</div><div class="line">        <span class="attr">"field1"</span> : <span class="string">"value1"</span></div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"negative"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123;</div><div class="line">        <span class="attr">"field2"</span> : <span class="string">"value2"</span></div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"negative_boost"</span> : <span class="number">0.2</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Indices-Query"><a href="#Indices-Query" class="headerlink" title="Indices Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-indices-query.html" target="_blank" rel="external">Indices Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"indices"</span> : &#123;</div><div class="line">    <span class="attr">"indices"</span> : [<span class="string">"index1"</span>, <span class="string">"index2"</span>],</div><div class="line">    <span class="attr">"query"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"wow"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"no_match_query"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"kow"</span> &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Limit-Query"><a href="#Limit-Query" class="headerlink" title="Limit Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-limit-query.html" target="_blank" rel="external">Limit Query</a></h5><p>A limit query limits the number of documents (per shard) to execute on.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span>: &#123;</div><div class="line">    <span class="attr">"must"</span>: &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123; <span class="attr">"name.first"</span> : <span class="string">"shay"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"limit"</span> : &#123;<span class="attr">"value"</span> : <span class="number">100</span>&#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="Joining-Queries"><a href="#Joining-Queries" class="headerlink" title="Joining Queries"></a>Joining Queries</h4><h5 id="Nested-Query"><a href="#Nested-Query" class="headerlink" title="Nested Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html" target="_blank" rel="external">Nested Query</a></h5><p>Sample mapping:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"type1"</span> : &#123;</div><div class="line">    <span class="attr">"properties"</span> : &#123;</div><div class="line">      <span class="attr">"obj1"</span> : &#123;</div><div class="line">        <span class="attr">"type"</span> : <span class="string">"nested"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Sample nested query:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"nested"</span> : &#123;</div><div class="line">    <span class="attr">"path"</span> : <span class="string">"obj1"</span>,</div><div class="line">    <span class="attr">"score_mode"</span> : <span class="string">"avg"</span>,</div><div class="line">    <span class="attr">"query"</span> : &#123;</div><div class="line">      <span class="attr">"bool"</span> : &#123;</div><div class="line">        <span class="attr">"must"</span> : [</div><div class="line">          &#123;</div><div class="line">            <span class="attr">"match"</span> : &#123;<span class="attr">"obj1.name"</span> : <span class="string">"blue"</span>&#125;</div><div class="line">          &#125;,</div><div class="line">          &#123;</div><div class="line">            <span class="attr">"range"</span> : &#123;<span class="attr">"obj1.count"</span> : &#123;<span class="attr">"gt"</span> : <span class="number">5</span>&#125;&#125;</div><div class="line">          &#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Has-Child-Query"><a href="#Has-Child-Query" class="headerlink" title="Has Child Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-child-query.html" target="_blank" rel="external">Has Child Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"has_child"</span> : &#123;</div><div class="line">    <span class="attr">"type"</span> : <span class="string">"blog_tag"</span>,</div><div class="line">    <span class="attr">"score_mode"</span> : <span class="string">"sum"</span>,</div><div class="line">    <span class="attr">"min_children"</span>: <span class="number">2</span>, </div><div class="line">    <span class="attr">"max_children"</span>: <span class="number">10</span>, </div><div class="line">    <span class="attr">"query"</span> : &#123;</div><div class="line">      <span class="attr">"term"</span> : &#123;</div><div class="line">        <span class="attr">"tag"</span> : <span class="string">"something"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Has-Parent-Query"><a href="#Has-Parent-Query" class="headerlink" title="Has Parent Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-parent-query.html" target="_blank" rel="external">Has Parent Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"has_parent"</span> : &#123;</div><div class="line">        <span class="attr">"parent_type"</span> : <span class="string">"blog"</span>,</div><div class="line">        <span class="attr">"score_mode"</span> : <span class="string">"score"</span>,</div><div class="line">        <span class="attr">"query"</span> : &#123;</div><div class="line">            <span class="attr">"term"</span> : &#123;</div><div class="line">                <span class="attr">"tag"</span> : <span class="string">"something"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h4 id="Geo-Queries"><a href="#Geo-Queries" class="headerlink" title="Geo Queries"></a>Geo Queries</h4><h5 id="GeoShape-Query"><a href="#GeoShape-Query" class="headerlink" title="GeoShape Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-shape-query.html" target="_blank" rel="external">GeoShape Query</a></h5><p>Requires the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-shape.html" target="_blank" rel="external">geo_shape Mapping</a>.</p>
<p>Given docoment:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Wind &amp; Wetter, Berlin, Germany"</span>,</div><div class="line">  <span class="attr">"location"</span>: &#123;</div><div class="line">    <span class="attr">"type"</span>: <span class="string">"Point"</span>,</div><div class="line">    <span class="attr">"coordinates"</span>: [<span class="number">13.400544</span>, <span class="number">52.530286</span>]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>With <code>envelope</code> extensoin:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query"</span>:&#123;</div><div class="line">    <span class="attr">"bool"</span>: &#123;</div><div class="line">      <span class="attr">"must"</span>: &#123;</div><div class="line">        <span class="attr">"match_all"</span>: &#123;&#125;</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">"filter"</span>: &#123;</div><div class="line">        <span class="attr">"geo_shape"</span>: &#123;</div><div class="line">          <span class="attr">"location"</span>: &#123;</div><div class="line">            <span class="attr">"shape"</span>: &#123;</div><div class="line">              <span class="attr">"type"</span>: <span class="string">"envelope"</span>,</div><div class="line">              <span class="attr">"coordinates"</span> : [[<span class="number">13.0</span>, <span class="number">53.0</span>], [<span class="number">14.0</span>, <span class="number">52.0</span>]]</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">"relation"</span>: <span class="string">"within"</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Geo-Bounding-Box-Query"><a href="#Geo-Bounding-Box-Query" class="headerlink" title="Geo Bounding Box Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-bounding-box-query.html" target="_blank" rel="external">Geo Bounding Box Query</a></h5><p>Given document:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"pin"</span> : &#123;</div><div class="line">    <span class="attr">"location"</span> : &#123;</div><div class="line">      <span class="attr">"lat"</span> : <span class="number">40.12</span>,</div><div class="line">      <span class="attr">"lon"</span> : <span class="number">-71.34</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Query:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span> : &#123;</div><div class="line">    <span class="attr">"must"</span> : &#123;</div><div class="line">      <span class="attr">"match_all"</span> : &#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"geo_bounding_box"</span> : &#123;</div><div class="line">        <span class="attr">"pin.location"</span> : &#123;</div><div class="line">          <span class="attr">"top_left"</span> : &#123;</div><div class="line">            <span class="attr">"lat"</span> : <span class="number">40.73</span>,</div><div class="line">            <span class="attr">"lon"</span> : <span class="number">-74.1</span></div><div class="line">          &#125;,</div><div class="line">          <span class="attr">"bottom_right"</span> : &#123;</div><div class="line">            <span class="attr">"lat"</span> : <span class="number">40.01</span>,</div><div class="line">            <span class="attr">"lon"</span> : <span class="number">-71.12</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="Geo-Distance-Queqy"><a href="#Geo-Distance-Queqy" class="headerlink" title="Geo Distance Queqy"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-distance-query.html" target="_blank" rel="external">Geo Distance Queqy</a></h5><p>Givven document:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"pin"</span> : &#123;</div><div class="line">    <span class="attr">"location"</span> : &#123;</div><div class="line">      <span class="attr">"lat"</span> : <span class="number">40.12</span>,</div><div class="line">      <span class="attr">"lon"</span> : <span class="number">-71.34</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Query:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span> : &#123;</div><div class="line">    <span class="attr">"must"</span> : &#123;</div><div class="line">      <span class="attr">"match_all"</span> : &#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"geo_distance"</span> : &#123;</div><div class="line">        <span class="attr">"distance"</span> : <span class="string">"200km"</span>,</div><div class="line">        <span class="attr">"pin.location"</span> : &#123;</div><div class="line">          <span class="attr">"lat"</span> : <span class="number">40</span>,</div><div class="line">          <span class="attr">"lon"</span> : <span class="number">-70</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Descript</th>
</tr>
</thead>
<tbody>
<tr>
<td>distance</td>
<td>The radius of the circle centred on the specified location. Points which fall into this circle are considered to be matches. The distance can be specified in various units. See the section called “Distance Unitsedit”.</td>
</tr>
<tr>
<td>distance_type</td>
<td>How to compute the distance. Can either be sloppy_arc (default), arc (slightly more precise but significantly slower) or plane (faster, but inaccurate on long distances and close to the poles).</td>
</tr>
<tr>
<td>optimize_bbox</td>
<td>Whether to use the optimization of first running a bounding box check before the distance check. Defaults to memory which will do in memory checks. Can also have values of indexed to use indexed value check (make sure the geo_point type index lat lon in this case), or none which disables bounding box optimization.</td>
</tr>
<tr>
<td>_name</td>
<td>Optional name field to identify the query</td>
</tr>
<tr>
<td>coerce</td>
<td>Set to true to normalize longitude and latitude values to a standard -180:180 / -90:90 coordinate system. (default is false).</td>
</tr>
<tr>
<td>ignore_malformed</td>
<td>Set to true to accept geo points with invalid latitude or longitude (default is false).</td>
</tr>
</tbody>
</table>
<h5 id="Geo-Distance-Range-Query"><a href="#Geo-Distance-Range-Query" class="headerlink" title="Geo Distance Range Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-distance-range-query.html" target="_blank" rel="external">Geo Distance Range Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span> : &#123;</div><div class="line">    <span class="attr">"must"</span> : &#123;</div><div class="line">      <span class="attr">"match_all"</span> : &#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"geo_distance_range"</span> : &#123;</div><div class="line">        <span class="attr">"from"</span> : <span class="string">"200km"</span>,</div><div class="line">        <span class="attr">"to"</span> : <span class="string">"400km"</span>,</div><div class="line">        <span class="attr">"pin.location"</span> : &#123;</div><div class="line">          <span class="attr">"lat"</span> : <span class="number">40</span>,</div><div class="line">          <span class="attr">"lon"</span> : <span class="number">-70</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Geo-Polygon-Query"><a href="#Geo-Polygon-Query" class="headerlink" title="Geo Polygon Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-polygon-query.html" target="_blank" rel="external">Geo Polygon Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"bool"</span> : &#123;</div><div class="line">    <span class="attr">"query"</span> : &#123;</div><div class="line">      <span class="attr">"match_all"</span> : &#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"filter"</span> : &#123;</div><div class="line">      <span class="attr">"geo_polygon"</span> : &#123;</div><div class="line">        <span class="attr">"person.location"</span> : &#123;</div><div class="line">          <span class="attr">"points"</span> : [</div><div class="line">            &#123;<span class="attr">"lat"</span> : <span class="number">40</span>, <span class="attr">"lon"</span> : <span class="number">-70</span>&#125;,</div><div class="line">            &#123;<span class="attr">"lat"</span> : <span class="number">30</span>, <span class="attr">"lon"</span> : <span class="number">-90</span>&#125;,</div><div class="line">            &#123;<span class="attr">"lat"</span> : <span class="number">20</span>, <span class="attr">"lon"</span> : <span class="number">-90</span>&#125;,</div><div class="line">            &#123;<span class="attr">"lat"</span> : <span class="number">10</span>, <span class="attr">"lon"</span> : <span class="number">-60</span>&#125;</div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>_name</td>
<td>Optional name field to identify the filter</td>
</tr>
<tr>
<td>coerce</td>
<td>Set to true to normalize longitude and latitude values to a standard -180:180 / -90:90 coordinate system. (default is false).</td>
</tr>
<tr>
<td>ignore_malformed</td>
<td>Set to true to accept geo points with invalid latitude or longitude (default is false).</td>
</tr>
</tbody>
</table>
<h5 id="Geohash-Cell-Query"><a href="#Geohash-Cell-Query" class="headerlink" title="Geohash Cell Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geohash-cell-query.html" target="_blank" rel="external">Geohash Cell Query</a></h5><p>Geohash needs be indexed:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"mappings"</span> : &#123;</div><div class="line">    <span class="attr">"location"</span>: &#123;</div><div class="line">      <span class="attr">"properties"</span>: &#123;</div><div class="line">        <span class="attr">"pin"</span>: &#123;</div><div class="line">          <span class="attr">"type"</span>: <span class="string">"geo_point"</span>,</div><div class="line">          <span class="attr">"geohash"</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">"geohash_prefix"</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">"geohash_precision"</span>: <span class="number">10</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="Specialized-Queries"><a href="#Specialized-Queries" class="headerlink" title="Specialized Queries"></a>Specialized Queries</h4><h5 id="More-Like-This-Query"><a href="#More-Like-This-Query" class="headerlink" title="More Like This Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html" target="_blank" rel="external">More Like This Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"more_like_this"</span> : &#123;</div><div class="line">    <span class="attr">"fields"</span> : [<span class="string">"title"</span>, <span class="string">"description"</span>],</div><div class="line">    <span class="attr">"like"</span> : <span class="string">"Once upon a time"</span>,</div><div class="line">    <span class="attr">"min_term_freq"</span> : <span class="number">1</span>,</div><div class="line">    <span class="attr">"max_query_terms"</span> : <span class="number">12</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Template-Query"><a href="#Template-Query" class="headerlink" title="Template Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-template-query.html" target="_blank" rel="external">Template Query</a></h5><p><strong>Based on Mustache.</strong><br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query"</span>: &#123;</div><div class="line">    <span class="attr">"template"</span>: &#123;</div><div class="line">      <span class="attr">"inline"</span>: &#123; <span class="attr">"match"</span>: &#123; <span class="attr">"text"</span>: <span class="string">"&#123;&#123;query_string&#125;&#125;"</span> &#125;&#125;,</div><div class="line">      <span class="attr">"params"</span> : &#123;</div><div class="line">        <span class="attr">"query_string"</span> : <span class="string">"all about search"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Stored template:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line">&#123;</div><div class="line">  &quot;query&quot;: &#123;</div><div class="line">    &quot;template&quot;: &#123;</div><div class="line">      &quot;file&quot;: &quot;my_template&quot;, </div><div class="line">      &quot;params&quot; : &#123;</div><div class="line">        &quot;query_string&quot; : &quot;all about search&quot;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Or:<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PUT /_search/template/my_template</div><div class="line">&#123;</div><div class="line">  <span class="string">"template"</span>: &#123; <span class="string">"match"</span>: &#123; <span class="string">"text"</span>: <span class="string">"&#123;&#123;query_string&#125;&#125;"</span> &#125;&#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"query"</span>: &#123;</div><div class="line">    <span class="attr">"template"</span>: &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="string">"my_template"</span>, </div><div class="line">      <span class="attr">"params"</span> : &#123;</div><div class="line">        <span class="attr">"query_string"</span> : <span class="string">"all about search"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Script-Query"><a href="#Script-Query" class="headerlink" title="Script Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-script-query.html" target="_blank" rel="external">Script Query</a></h5><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="string">"bool"</span> : &#123;</div><div class="line">  <span class="string">"must"</span> : &#123;</div><div class="line">    ...</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"filter"</span> : &#123;</div><div class="line">    <span class="string">"script"</span> : &#123;</div><div class="line">      <span class="string">"script"</span> : "<span class="type">doc</span>[<span class="symbol">'num1</span>'].value &gt; <span class="number">1</span><span class="string">"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Span-Query"><a href="#Span-Query" class="headerlink" title="Span Query"></a>Span Query</h4><h5 id="Span-Term-Query"><a href="#Span-Term-Query" class="headerlink" title="Span Term Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-term-query.html" target="_blank" rel="external">Span Term Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : &#123; <span class="attr">"value"</span> : <span class="string">"kimchy"</span>, <span class="attr">"boost"</span> : <span class="number">2.0</span> &#125; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-Multi-Term-Query"><a href="#Span-Multi-Term-Query" class="headerlink" title="Span Multi Term Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-multi-term-query.html" target="_blank" rel="external">Span Multi Term Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_multi"</span>:&#123;</div><div class="line">    <span class="attr">"match"</span>:&#123;</div><div class="line">      <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> :  &#123; <span class="attr">"value"</span> : <span class="string">"ki"</span>, <span class="attr">"boost"</span> : <span class="number">1.08</span> &#125; &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-First-Query"><a href="#Span-First-Query" class="headerlink" title="Span First Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-first-query.html" target="_blank" rel="external">Span First Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_first"</span> : &#123;</div><div class="line">    <span class="attr">"match"</span> : &#123;</div><div class="line">      <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"end"</span> : <span class="number">3</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-Near-Query"><a href="#Span-Near-Query" class="headerlink" title="Span Near Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-near-query.html" target="_blank" rel="external">Span Near Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_near"</span> : &#123;</div><div class="line">    <span class="attr">"clauses"</span> : [</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">"slop"</span> : <span class="number">12</span>,</div><div class="line">    <span class="attr">"in_order"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="attr">"collect_payloads"</span> : <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-Or-Query"><a href="#Span-Or-Query" class="headerlink" title="Span Or Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-or-query.html" target="_blank" rel="external">Span Or Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_or"</span> : &#123;</div><div class="line">    <span class="attr">"clauses"</span> : [</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</div><div class="line">      &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-Not-Query"><a href="#Span-Not-Query" class="headerlink" title="Span Not Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-not-query.html" target="_blank" rel="external">Span Not Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_not"</span> : &#123;</div><div class="line">    <span class="attr">"include"</span> : &#123;</div><div class="line">      <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"exclude"</span> : &#123;</div><div class="line">      <span class="attr">"span_near"</span> : &#123;</div><div class="line">        <span class="attr">"clauses"</span> : [</div><div class="line">          &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"la"</span> &#125; &#125;,</div><div class="line">          &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125; &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"slop"</span> : <span class="number">0</span>,</div><div class="line">        <span class="attr">"in_order"</span> : <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Span-Containing-Query"><a href="#Span-Containing-Query" class="headerlink" title="Span Containing Query"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-containing-query.html" target="_blank" rel="external">Span Containing Query</a></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"span_containing"</span> : &#123;</div><div class="line">    <span class="attr">"little"</span> : &#123;</div><div class="line">      <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"foo"</span> &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"big"</span> : &#123;</div><div class="line">      <span class="attr">"span_near"</span> : &#123;</div><div class="line">        <span class="attr">"clauses"</span> : [</div><div class="line">          &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"bar"</span> &#125; &#125;,</div><div class="line">          &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"baz"</span> &#125; &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"slop"</span> : <span class="number">5</span>,</div><div class="line">        <span class="attr">"in_order"</span> : <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>mapping</p>
<p>Mapping Options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>tree</td>
<td>geohash / quadtree</td>
<td>geohash</td>
</tr>
<tr>
<td>precision</td>
<td>in, inch, yd, yard, mi, miles, km, kilometers, m,meters, cm,centimeters, mm, millimeters</td>
<td>meters</td>
</tr>
<tr>
<td>tree_levels</td>
<td></td>
<td>50m</td>
</tr>
<tr>
<td>strategy</td>
<td>The approach for how to represent shapes at indexing and search time</td>
<td>recursive</td>
</tr>
<tr>
<td>distance_error_pct</td>
<td>precise</td>
<td>0.025 ((2.5%)</td>
</tr>
<tr>
<td>orientation</td>
<td>Optionally define how to interpret vertex order for polygons / multipolygons</td>
<td>ccw</td>
</tr>
<tr>
<td>points_only</td>
<td></td>
<td>false</td>
</tr>
</tbody>
</table>
<p><a href="http://www.geojson.org/" target="_blank" rel="external">GeoJSON</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Terms&quot;&gt;&lt;a href=&quot;#Terms&quot; class=&quot;headerlink&quot; title=&quot;Terms&quot;&gt;&lt;/a&gt;Terms&lt;/h2&gt;&lt;h3 id=&quot;Mapping&quot;&gt;&lt;a href=&quot;#Mapping&quot; class=&quot;headerlink&quot; title=
    
    </summary>
    
    
      <category term="search" scheme="http://www.orctom.com/tags/search/"/>
    
  </entry>
  
  <entry>
    <title>MQ</title>
    <link href="http://www.orctom.com/2017/05/16/mq/"/>
    <id>http://www.orctom.com/2017/05/16/mq/</id>
    <published>2017-05-16T15:40:26.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><ul>
<li>AMQP</li>
<li>less scalable</li>
<li>relatively slow, as the central node adds latency and big message envelopes</li>
<li>supports persistence across reboot</li>
</ul>
<h3 id="ZeroMQ"><a href="#ZeroMQ" class="headerlink" title="ZeroMQ"></a>ZeroMQ</h3><ul>
<li>AMQP</li>
<li>lightweight</li>
<li>high throughput / low latency</li>
<li>very flexable, that you’ll have to implement features that provided by RabbitMQ by youself</li>
<li>doesn’t support persistence across reboot</li>
</ul>
<h3 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h3><ul>
<li>in the middle</li>
<li>Persistence<ul>
<li>KahahDB (default), since 5.3</li>
<li>LevelDB (future, as it’s faster and cheaper), since 5.8</li>
</ul>
</li>
<li>AMQP v1.0</li>
<li>MQTT v3.1</li>
<li>Durable:</li>
<li>Persistent</li>
<li>protocols:<ul>
<li>static: defining networks of brokers with known addresses</li>
<li>failover: providing reconnection logic even for a single broker</li>
<li>multicast: defining dynamic networks of brokers</li>
<li>discovery: clients to connect dynamic network of brokers</li>
<li>peer: connecting multipile enbedded brokers</li>
<li>fanout: producing messages to multipile unconnected brokers</li>
</ul>
</li>
<li>message store<ul>
<li>KahaDB</li>
<li>AMQ: best option when throughput is the main requirement.</li>
</ul>
<ul>
<li>two seperated files for each index</li>
<li>an index per destination</li>
<li>So, do not use it if you have thousands of queues, as rebuildindexes takes a long while</li>
</ul>
<ul>
<li>JDBC</li>
<li>Memory</li>
</ul>
<ul>
<li>finite amount of messages, and will be consumed quickly</li>
<li>which is actually setting <code>persistent</code> to <code>false</code></li>
</ul>
<ul>
<li>Caching</li>
</ul>
<ul>
<li>caching messages for reconnection, so that it recovers quickly</li>
<li><code>subscription recovery policy</code><ul>
<li>fixed size (default)</li>
<li>fixed count</li>
<li>query based (matching)</li>
<li>timed</li>
<li>last image</li>
<li>no</li>
</ul>
</li>
<li>HA</li>
</ul>
</li>
</ul>
<ul>
<li>Shared nothing (when some down time on failure is acceptable)</li>
<li>Shared storage</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;RabbitMQ&quot;&gt;&lt;a href=&quot;#RabbitMQ&quot; class=&quot;headerlink&quot; title=&quot;RabbitMQ&quot;&gt;&lt;/a&gt;RabbitMQ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;AMQP&lt;/li&gt;
&lt;li&gt;less scalable&lt;/li&gt;
&lt;li&gt;rel
    
    </summary>
    
    
      <category term="mq" scheme="http://www.orctom.com/tags/mq/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS Misc</title>
    <link href="http://www.orctom.com/2017/05/16/https-misc/"/>
    <id>http://www.orctom.com/2017/05/16/https-misc/</id>
    <published>2017-05-16T15:38:37.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JCE"><a href="#JCE" class="headerlink" title="JCE"></a>JCE</h2><p>Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files.</p>
<p>If you need keys that longer than 1024 bits. Unzip the <code>jce</code> package into <code>$JAVA_HOME/lib/security/</code></p>
<h3 id="JDK-7"><a href="#JDK-7" class="headerlink" title="JDK 7"></a>JDK 7</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -jkLH <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http:<span class="regexp">//</span>download.oracle.com<span class="regexp">/otn-pub/</span>java<span class="regexp">/jce/</span><span class="number">7</span><span class="regexp">/UnlimitedJCEPolicyJDK7.zip -o UnlimitedJCEPolicyJDK7.zip</span></div></pre></td></tr></table></figure>
<h3 id="JDK-8"><a href="#JDK-8" class="headerlink" title="JDK 8"></a>JDK 8</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -jkLH <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http:<span class="regexp">//</span>download.oracle.com<span class="regexp">/otn-pub/</span>java<span class="regexp">/jce/</span><span class="number">8</span><span class="regexp">/jce_policy-8.zip -o jce_policy-8.zip</span></div></pre></td></tr></table></figure>
<h2 id="File-Formats"><a href="#File-Formats" class="headerlink" title="File Formats"></a>File Formats</h2><h3 id="pem"><a href="#pem" class="headerlink" title=".pem"></a>.pem</h3><p>Privacy Enhanced Mail, a way of encoding data.<br>It may contain:</p>
<ul>
<li>public key (certificate)</li>
<li>private key</li>
<li>CA certificates (root, chain)</li>
<li>CSR pkcs10 encoded (not common)</li>
</ul>
<h3 id="csr"><a href="#csr" class="headerlink" title=".csr"></a>.csr</h3><p>Format of pkcs10, you generate csr and submit it to the CA to generate your certificate.</p>
<h3 id="key"><a href="#key" class="headerlink" title=".key"></a>.key</h3><p>Private key or public key.</p>
<h3 id="pkcs12-pfx-p12"><a href="#pkcs12-pfx-p12" class="headerlink" title=".pkcs12 .pfx .p12"></a>.pkcs12 .pfx .p12</h3><p>A passworded container format that contains both public and private certificate pairs. Unlike .pem files, this container is fully encrypted.<br>Openssl can turn this into a .pem file with both public and private keys:<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 \</div><div class="line">  -<span class="ruby">nodes \</span></div><div class="line">  -<span class="ruby"><span class="keyword">in</span> file-to-convert.p12 \</span></div><div class="line">  -<span class="ruby">out converted-file.pem</span></div></pre></td></tr></table></figure></p>
<h3 id="der"><a href="#der" class="headerlink" title=".der"></a>.der</h3><p>The parent format of PEM. It’s useful to think of it as a binary version of the base64-encoded PEM file. Not routinely used by much outside of Windows.</p>
<h3 id="cert-cer-crt"><a href="#cert-cer-crt" class="headerlink" title=".cert .cer .crt"></a>.cert .cer .crt</h3><p>A .pem (or rarely .der) formatted file with a different extension, one that is recognized by Windows Explorer as a certificate, which .pem is not.</p>
<p>### </p>
<h2 id="Openssl"><a href="#Openssl" class="headerlink" title="Openssl"></a>Openssl</h2><p>Generate a new private key and Certificate Signing Request<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">openssl req \</div><div class="line">  -<span class="ruby">newkey <span class="symbol">rsa:</span><span class="number">2048</span> \</span></div><div class="line">  -<span class="ruby">nodes \</span></div><div class="line">  -<span class="ruby">keyout private.key \</span></div><div class="line">  -<span class="ruby">out domain.csr</span></div></pre></td></tr></table></figure></p>
<p>Generate a self-signed certificate<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">openssl req \</div><div class="line">  -<span class="ruby">x509 \</span></div><div class="line">  -<span class="ruby">sha256 \</span></div><div class="line">  -<span class="ruby">nodes \</span></div><div class="line">  -<span class="ruby">days <span class="number">3600</span> \</span></div><div class="line">  -<span class="ruby">newkey <span class="symbol">rsa:</span><span class="number">2048</span> \</span></div><div class="line">  -<span class="ruby">keyout private.key</span></div><div class="line">  -<span class="ruby">out certificate.crt</span></div></pre></td></tr></table></figure></p>
<p>Generate a certificate signing request (CSR) for an existing private key<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">openssl req \</div><div class="line">  -<span class="ruby">new \</span></div><div class="line">  -<span class="ruby">key private.key \</span></div><div class="line">  -<span class="ruby">out domain.csr</span></div></pre></td></tr></table></figure></p>
<p>Remove a passphrase from a private key<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl rsa -<span class="keyword">in</span> privateKey.pem -out <span class="keyword">new</span><span class="type">PrivateKey</span>.pem</div></pre></td></tr></table></figure></p>
<p>Convert DER file (.crt .cer .der) to PEM<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">openssl x509 \</div><div class="line">  -<span class="ruby">inform der \</span></div><div class="line">  -<span class="ruby"><span class="keyword">in</span> cert.cer \</span></div><div class="line">  -<span class="ruby">out cert.pem</span></div></pre></td></tr></table></figure></p>
<p>Convert PEM file to DER<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">openssl x509 \</div><div class="line">  -<span class="ruby">outform der \</span></div><div class="line">  -<span class="ruby"><span class="keyword">in</span> cert.pem \</span></div><div class="line">  -<span class="ruby">out certi.der</span></div></pre></td></tr></table></figure></p>
<p>Importing an existing certificate into a PKCS12 keystore<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -export \</div><div class="line">  -<span class="ruby"><span class="keyword">in</span> domain.crt \</span></div><div class="line">  -<span class="ruby">inkey domain.key \</span></div><div class="line">  -<span class="ruby">out domain.p12 \</span></div><div class="line">  -<span class="ruby">name tomcat \</span></div><div class="line">  -<span class="ruby">CAfile ca.crt \</span></div><div class="line">  -<span class="ruby">caname root \</span></div><div class="line">  -<span class="ruby">chain</span></div></pre></td></tr></table></figure></p>
<h2 id="Keytool"><a href="#Keytool" class="headerlink" title="Keytool"></a>Keytool</h2><p>Create a keystore file to store the server’s private key and self-signed certificate<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">keytool -genkey \</div><div class="line">  -<span class="ruby"><span class="keyword">alias</span> domain.com \</span></div><div class="line">  -<span class="ruby">keyalg RSA \</span></div><div class="line">  -<span class="ruby">keystore keystore.jks \</span></div><div class="line">  -<span class="ruby">validity <span class="number">3600</span></span></div></pre></td></tr></table></figure></p>
<p>Create a CSR based on the keystore<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">keytool -certreq \</div><div class="line">  -<span class="ruby">keyalg RSA \</span></div><div class="line">  -<span class="ruby"><span class="keyword">alias</span> tomcat \</span></div><div class="line">  -<span class="ruby">file certreq.csr</span></div><div class="line">  -<span class="ruby">keystore keystore.jks</span></div></pre></td></tr></table></figure></p>
<p>Import the self-signed certificate into JRE’s keystore, so that your Java program can communicate with remote servers that serve https services with that self-signed certificate<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">keytool -importcert \</div><div class="line">  -<span class="ruby">keystore <span class="string">"$JAVA_HOME/lib/security/cacerts"</span> \</span></div><div class="line">  -<span class="ruby">file corp.cer \</span></div><div class="line">  -<span class="ruby"><span class="keyword">alias</span> corpcert</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;JCE&quot;&gt;&lt;a href=&quot;#JCE&quot; class=&quot;headerlink&quot; title=&quot;JCE&quot;&gt;&lt;/a&gt;JCE&lt;/h2&gt;&lt;p&gt;Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction 
    
    </summary>
    
    
      <category term="https" scheme="http://www.orctom.com/tags/https/"/>
    
  </entry>
  
  <entry>
    <title>Linux Misc</title>
    <link href="http://www.orctom.com/2017/05/16/linux-misc/"/>
    <id>http://www.orctom.com/2017/05/16/linux-misc/</id>
    <published>2017-05-16T15:37:42.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Linux-distribution-info"><a href="#Linux-distribution-info" class="headerlink" title="Linux distribution info"></a>Linux distribution info</h3><ul>
<li><code>cat /etc/*-release</code></li>
<li><code>lsb_release -a</code></li>
<li><code>uname -mrs</code></li>
</ul>
<h3 id="Check-ram-info"><a href="#Check-ram-info" class="headerlink" title="Check ram info"></a>Check ram info</h3><ul>
<li><code>sudo dmidecode -t memory</code></li>
<li><code>sudo lshw -short -C memory</code></li>
</ul>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><h4 id="File-operators"><a href="#File-operators" class="headerlink" title="File operators"></a>File operators</h4><table>
<thead>
<tr>
<th>operator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-e</td>
<td>file exists</td>
</tr>
<tr>
<td>-a</td>
<td>same as <code>-e</code>, deprecated</td>
</tr>
<tr>
<td>-f</td>
<td>file is a regular file (not a directory or device file)</td>
</tr>
<tr>
<td>-s</td>
<td>file is not zero size</td>
</tr>
<tr>
<td>-d</td>
<td>file is a directory</td>
</tr>
<tr>
<td>-b</td>
<td>file is a block device</td>
</tr>
<tr>
<td>-c</td>
<td>file is a character device</td>
</tr>
<tr>
<td>-p</td>
<td>file is a pipe</td>
</tr>
<tr>
<td>-h</td>
<td>file is a symbolic link</td>
</tr>
<tr>
<td>-L</td>
<td>file is a symbolic link</td>
</tr>
<tr>
<td>-S</td>
<td>file is a socket</td>
</tr>
<tr>
<td>-t</td>
<td>file is associated with a terminal device</td>
</tr>
<tr>
<td>-r</td>
<td>file has read permission</td>
</tr>
<tr>
<td>-w</td>
<td>file has write permission</td>
</tr>
<tr>
<td>-x</td>
<td>file has execution permission</td>
</tr>
<tr>
<td>-O</td>
<td>you are owner of file</td>
</tr>
<tr>
<td>-G</td>
<td>group-id of file same as yours</td>
</tr>
<tr>
<td>-N</td>
<td>file modified since it was last read</td>
</tr>
<tr>
<td>f1 -nt f2</td>
<td>file f1 is newer than f2</td>
</tr>
<tr>
<td>f1 -ot f2</td>
<td>file f1 is older than f2</td>
</tr>
<tr>
<td>f1 -ef f2</td>
<td>files f1 and f2 are hard links to the same file</td>
</tr>
</tbody>
</table>
<h4 id="String-operators"><a href="#String-operators" class="headerlink" title="String operators"></a>String operators</h4><table>
<thead>
<tr>
<th>operator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>the length is nonzero</td>
</tr>
<tr>
<td>-z</td>
<td>the length is zero</td>
</tr>
<tr>
<td>s1 = s2</td>
<td>two strings are identical</td>
</tr>
<tr>
<td>s1 != s2</td>
<td>two strings are not identical</td>
</tr>
<tr>
<td>s1</td>
<td>s1 is not null</td>
</tr>
</tbody>
</table>
<h4 id="Number-operators"><a href="#Number-operators" class="headerlink" title="Number operators"></a>Number operators</h4><table>
<thead>
<tr>
<th>operator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-eq</td>
<td>equal</td>
</tr>
<tr>
<td>-ne</td>
<td>not equal</td>
</tr>
<tr>
<td>-gt</td>
<td>greater than</td>
</tr>
<tr>
<td>-ge</td>
<td>greater or equal</td>
</tr>
<tr>
<td>-lt</td>
<td>less than</td>
</tr>
<tr>
<td>-le</td>
<td>less or equal</td>
</tr>
</tbody>
</table>
<h4 id="Script-environment"><a href="#Script-environment" class="headerlink" title="Script environment"></a>Script environment</h4><ul>
<li><code>set -x</code> Print commands and their arguments as they are executed.</li>
<li><code>set +x</code> Disabling it.</li>
</ul>
<h2 id="Open-files"><a href="#Open-files" class="headerlink" title="Open files"></a>Open files</h2><p>List File Opened By a PID<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo lsof -<span class="selector-tag">p</span> &lt;pid&gt;</div></pre></td></tr></table></figure></p>
<p>List File Descriptors in Kernel Memory<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo sysctl fs.<span class="keyword">file</span>-<span class="built_in">max</span></div></pre></td></tr></table></figure></p>
<h2 id="Network-Usage"><a href="#Network-Usage" class="headerlink" title="Network Usage"></a>Network Usage</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">get</span> install speedometer</div></pre></td></tr></table></figure>
<h3 id="Password"><a href="#Password" class="headerlink" title="Password"></a>Password</h3><h4 id="random-password"><a href="#random-password" class="headerlink" title="random password"></a>random password</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">openssl</span> rand -<span class="keyword">base64 </span><span class="number">12</span></div></pre></td></tr></table></figure>
<h4 id="nginx-basic-auth"><a href="#nginx-basic-auth" class="headerlink" title="nginx basic auth"></a>nginx basic auth</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">location</span> /protected &#123;</div><div class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</div><div class="line">    <span class="attribute">auth_basic</span> <span class="string">"Restricted"</span>;</div><div class="line">    <span class="attribute">auth_basic_user_file</span> /etc/nginx/conf.d/.htpasswd;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"user:<span class="variable">$(openssl passwd -1 password)</span>\n"</span> &gt;&gt; .htpasswd</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Linux-distribution-info&quot;&gt;&lt;a href=&quot;#Linux-distribution-info&quot; class=&quot;headerlink&quot; title=&quot;Linux distribution info&quot;&gt;&lt;/a&gt;Linux distributio
    
    </summary>
    
    
      <category term="linux" scheme="http://www.orctom.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS Tomcat Configuration</title>
    <link href="http://www.orctom.com/2017/05/16/https-tomcat/"/>
    <id>http://www.orctom.com/2017/05/16/https-tomcat/</id>
    <published>2017-05-16T15:33:29.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Accepted-format-for-keystore"><a href="#Accepted-format-for-keystore" class="headerlink" title="Accepted format for keystore"></a>Accepted format for keystore</h2><ul>
<li>JKS</li>
<li>PKCS11</li>
<li>PKCS12 (an internet standard, can be manipulated thru openssl)</li>
</ul>
<h3 id="JKS"><a href="#JKS" class="headerlink" title="JKS"></a>JKS</h3><ol>
<li><p>Import root certificate (certificate of the CA where your certificate is signed)</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">keytool -import -trustcacerts \</div><div class="line">  -<span class="ruby"><span class="keyword">alias</span> root \</span></div><div class="line">  -<span class="ruby">file RootCertFileName.crt \</span></div><div class="line">  -<span class="ruby">keystore keystore</span></div></pre></td></tr></table></figure>
<p>(<br>Or MAYBE copy the keystore from jre as the base<br><code>cp $JAVA_HOME/lib/security/cacerts keystore</code><br>or<br><code>cp /etc/ssl/certs/java/cacerts keystore</code><br>)</p>
</li>
<li><p>Import the certificate signed by a CA</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">keytool -import \</div><div class="line">  -<span class="ruby"><span class="keyword">alias</span> tomcat \</span></div><div class="line">  -<span class="ruby">keystore keystore \</span></div><div class="line">  -<span class="ruby">file &lt;your_certificate_filename&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="PKCS12"><a href="#PKCS12" class="headerlink" title="PKCS12"></a>PKCS12</h3><p>Prepare the certificate keystore<br>Importing an existing certificate into a PKCS12 keystore<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -export \</div><div class="line">  -<span class="ruby"><span class="keyword">in</span> domain.crt \</span></div><div class="line">  -<span class="ruby">inkey domain.key \</span></div><div class="line">  -<span class="ruby">out domain.p12 \</span></div><div class="line">  -<span class="ruby">name tomcat \</span></div><div class="line">  -<span class="ruby">CAfile ca.crt \</span></div><div class="line">  -<span class="ruby">caname root \</span></div><div class="line">  -<span class="ruby">chain</span></div></pre></td></tr></table></figure></p>
<h2 id="JSSE"><a href="#JSSE" class="headerlink" title="JSSE"></a>JSSE</h2><p>JSSE implementation is provided as part of the Java runtime.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Define a SSL Coyote HTTP/1.1 Connector on port 8443 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span></span></div><div class="line">           <span class="attr">port</span>=<span class="string">"8443"</span> <span class="attr">maxThreads</span>=<span class="string">"200"</span></div><div class="line">           <span class="attr">scheme</span>=<span class="string">"https"</span> <span class="attr">secure</span>=<span class="string">"true"</span> <span class="attr">SSLEnabled</span>=<span class="string">"true"</span></div><div class="line">           <span class="attr">keystoreFile</span>=<span class="string">"path/to/domain.p12"</span> </div><div class="line">           <span class="attr">keystorePass</span>=<span class="string">"changeit"</span></div><div class="line">           <span class="attr">keyAlias</span>=<span class="string">"tomcat"</span></div><div class="line">           <span class="attr">clientAuth</span>=<span class="string">"false"</span> <span class="attr">sslProtocol</span>=<span class="string">"TLS"</span>/&gt;</div></pre></td></tr></table></figure></p>
<h2 id="APR-recommended"><a href="#APR-recommended" class="headerlink" title="APR (recommended)"></a>APR (recommended)</h2><p>APR (native) implementation uses the OpenSSL engine by default, more faster than JSSE approach.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Define a SSL Coyote HTTP/1.1 Connector on port 8443 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8443"</span> <span class="attr">scheme</span>=<span class="string">"https"</span></span></div><div class="line">           <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11AprProtocol"</span></div><div class="line">           <span class="attr">maxThreads</span>=<span class="string">"200"</span> <span class="attr">secure</span>=<span class="string">"true"</span> <span class="attr">SSLEnabled</span>=<span class="string">"true"</span></div><div class="line">           <span class="attr">SSLCertificateFile</span>=<span class="string">"ssl/preshop.crt"</span></div><div class="line">           <span class="attr">SSLCertificateKeyFile</span>=<span class="string">"ssl/private.key"</span></div><div class="line">           <span class="attr">SSLCertificateChainFile</span>=<span class="string">"ssl/intermediate.crt"</span></div><div class="line">           <span class="attr">SSLCACertificateFile</span>=<span class="string">"ssl/root.crt"</span></div><div class="line">           <span class="attr">SSLProtocol</span>=<span class="string">"TLSv1+TLSv1.1+TLSv1.2"</span>/&gt;</div></pre></td></tr></table></figure></p>
<h2 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h2><p>If you want to ensure resources in your application is only be accessable thur https, you can configure the web.xml in your application:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">security-constraint</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">web-resource-collection</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">web-resource-name</span>&gt;</span>secured<span class="tag">&lt;/<span class="name">web-resource-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">web-resource-collection</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">user-data-constraint</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="tag">&lt;/<span class="name">transport-guarantee</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">user-data-constraint</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">security-constraint</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="APR-Installation"><a href="#APR-Installation" class="headerlink" title="APR Installation"></a>APR Installation</h2><h3 id="Compile-APR"><a href="#Compile-APR" class="headerlink" title="Compile APR"></a>Compile APR</h3><pre>
wget http://apache.fayea.com/apr/apr-1.5.2.tar.gz
wget http://apache.fayea.com/apr/apr-iconv-1.2.1.tar.gz
wget http://apache.fayea.com/apr/apr-util-1.5.4.tar.gz

tar -xvf apr-1.5.2.tar.gz
tar -xvf apr-iconv-1.2.1.tar.gz
tar -xvf apr-util-1.5.4.tar.gz

(
  cd apr-1.5.2
  ./configure --prefix=/usr/local/apr
  make
  sudo make install
)

(
  cd apr-iconv-1.2.1
  ./configure --prefix=/usr/local/apr-iconv --with-apr=/usr/local/apr
  make
  sudo make install
)

(
  cd apr-util-1.5.4
  ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr --with-apr-iconv=/usr/local/apr-iconv/  bin/apriconv
  make
  sudo make install
)

(
  cd $CATALINA_HOME/bin/
  tar -xvf tomcat-native.tar.gz
  cd tomcat-native-*-src/native
  ./configure --with-apr=/usr/local/apr --with-java-home=`echo $JAVA_HOME`
  make
  sudo make install
)
</pre>

<h3 id="Configure-Tomcat-to-Use-APR"><a href="#Configure-Tomcat-to-Use-APR" class="headerlink" title="Configure Tomcat to Use APR"></a>Configure Tomcat to Use APR</h3><p>vim $CATALINA_HOME/bin/catalina.sh, add the following to the beginning of the content:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">CATALINA_OPTS</span>=<span class="string">"-Djava.library.path=/usr/local/apr/lib"</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Accepted-format-for-keystore&quot;&gt;&lt;a href=&quot;#Accepted-format-for-keystore&quot; class=&quot;headerlink&quot; title=&quot;Accepted format for keystore&quot;&gt;&lt;/a&gt;Ac
    
    </summary>
    
    
      <category term="https" scheme="http://www.orctom.com/tags/https/"/>
    
      <category term="tomcat" scheme="http://www.orctom.com/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>PlantUML</title>
    <link href="http://www.orctom.com/2017/05/16/plantuml/"/>
    <id>http://www.orctom.com/2017/05/16/plantuml/</id>
    <published>2017-05-16T15:23:28.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Table-Diagram"><a href="#Table-Diagram" class="headerlink" title="Table Diagram"></a>Table Diagram</h3><figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="title">@startuml</span></div><div class="line"><span class="title">!define</span> table(<span class="keyword">x</span>) class <span class="keyword">x</span> &lt;&lt; (T,#AAFFFF) &gt;&gt;</div><div class="line"><span class="title">!define</span> pk(<span class="keyword">x</span>) &lt;u&gt;<span class="keyword">x</span>&lt;/u&gt;</div><div class="line"></div><div class="line">table(dummy) &#123;</div><div class="line">  Descriptions</div><div class="line">  ==</div><div class="line">  +FIELD<span class="number">1</span> int(<span class="number">10</span>) -- A comment</div><div class="line">  -FIELD<span class="number">2</span> int(<span class="number">10</span>)</div><div class="line">  #FIELD<span class="number">3</span> varchar(<span class="number">128</span>)</div><div class="line">&#125;</div><div class="line"><span class="title">@enduml</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Table-Diagram&quot;&gt;&lt;a href=&quot;#Table-Diagram&quot; class=&quot;headerlink&quot; title=&quot;Table Diagram&quot;&gt;&lt;/a&gt;Table Diagram&lt;/h3&gt;&lt;figure class=&quot;highlight llvm
    
    </summary>
    
    
      <category term="uml" scheme="http://www.orctom.com/tags/uml/"/>
    
  </entry>
  
  <entry>
    <title>armbian</title>
    <link href="http://www.orctom.com/2017/05/16/armbiam/"/>
    <id>http://www.orctom.com/2017/05/16/armbiam/</id>
    <published>2017-05-16T15:22:09.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">echo</span> <span class="string">"deb https://packagecloud.io/Hypriot/Schatzkiste/debian/ wheezy main"</span> &gt; /etc/apt/sources.<span class="keyword">list</span>.d/hypriot.<span class="keyword">list</span></div><div class="line">curl http<span class="variable">s:</span>//packagecloud.io/gpg.key | sudo apt-key <span class="built_in">add</span> -</div><div class="line">apt-<span class="built_in">get</span> <span class="keyword">update</span></div><div class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> install --<span class="keyword">no</span>-install-recommends docker-hypriot</div><div class="line">apt-<span class="built_in">get</span> -<span class="keyword">y</span> install cgroupfs-mount</div><div class="line">apt-<span class="built_in">get</span> install dmsetup</div><div class="line">dmsetup rmmvoe docker-<span class="number">179</span>:<span class="number">1</span>-<span class="number">376641</span>-pool</div><div class="line">reboot</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Docker&quot;&gt;&lt;a href=&quot;#Docker&quot; class=&quot;headerlink&quot; title=&quot;Docker&quot;&gt;&lt;/a&gt;Docker&lt;/h2&gt;&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutte
    
    </summary>
    
    
      <category term="armbian" scheme="http://www.orctom.com/tags/armbian/"/>
    
      <category term="docker" scheme="http://www.orctom.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Linux I/O Scheduler</title>
    <link href="http://www.orctom.com/2017/05/06/linux-scheduler/"/>
    <id>http://www.orctom.com/2017/05/06/linux-scheduler/</id>
    <published>2017-05-06T15:58:03.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="What-Is-I-O-Scheduler"><a href="#What-Is-I-O-Scheduler" class="headerlink" title="What Is I/O Scheduler"></a>What Is I/O Scheduler</h3><p>The purpose of I/O Scheduler is to improve the I/O performance fo traditional hard disk drive.<br>Like merging I/O requests to similar locations on disk, so that the drive doesn’t need to “seek” as often, improving the overall response time for disk operations.</p>
<p>It tries to balance between these goals:</p>
<ul>
<li>fairness (let every process have its share of the access to disk)</li>
<li>performance (try to serve requests close to current disk head position first, because seeking there is fastest)</li>
<li>realtime (guarantee that a request is serviced in a given time)</li>
</ul>
<h3 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h3><ul>
<li><strong>deadline</strong> scheduler<br>Two queues: a <em>read queue</em> and a <em>write queue</em>.<br>Each I/O request has a time stamp associated that is used by the kernel for an expiration time.<br>The default “deadline” values are 500 ms for <em>read</em> operations and 5,000 ms for <em>write</em> operations, which means <strong>good for read-heavy workload</strong>.<br>This is a cyclic elevator but with a twist: requests are given a deadline by which they get served. When a request starts to look like it’s going to expire, the kernel will skip intermediate sectors and move to that request, thus giving some realtime behaviour.</li>
<li><strong>AS</strong> (Anticipatory Scheduler) scheduler<br>A cyclic elevator with waiting policy: after you service a request that looks like it might have future requests coming nearby, you pause even if there’s more sectors in your work queue. The anticipatory scheduler literally anticipates more requests to follow on this track or very close by. How AS decides whether to anticipate is basically just lot of guesswork based on typical access patterns.</li>
<li><strong>cfq</strong> (Complete Fairness Queueing) scheduler<br>The default for most Linux distributions.<br>Providing a fair I/O priority to each process (round-robin), each process has it’s own queue.</li>
<li><strong>noop</strong> scheduler<br>No special Operation, no algorithms, raw, just serve the requests in the FIFO queue one by one.<br><strong>Good for SSD</strong>.</li>
</ul>
<h3 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h3><h4 id="Identifying-Current-I-O-Scheduler"><a href="#Identifying-Current-I-O-Scheduler" class="headerlink" title="Identifying Current I/O Scheduler"></a>Identifying Current I/O Scheduler</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat <span class="regexp">/sys/</span>block<span class="regexp">/sda/</span>queue<span class="regexp">/scheduler</span></div></pre></td></tr></table></figure>
<h4 id="Changing-IO-Scheduler-on-Runtime"><a href="#Changing-IO-Scheduler-on-Runtime" class="headerlink" title="Changing IO Scheduler on Runtime"></a>Changing IO Scheduler on Runtime</h4><p>This change takes effect immediately, but is <em>NOT</em> permanent.<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo <span class="string">"noop"</span> &gt; <span class="regexp">/sys/</span>block<span class="regexp">/sda/</span>queue<span class="regexp">/scheduler</span></div></pre></td></tr></table></figure></p>
<h4 id="Changing-the-Scheduler-on-Boot"><a href="#Changing-the-Scheduler-on-Boot" class="headerlink" title="Changing the Scheduler on Boot"></a>Changing the Scheduler on Boot</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi <span class="regexp">/etc/</span><span class="keyword">default</span><span class="regexp">/grub</span></div></pre></td></tr></table></figure>
<p>Add is the elevator parameter:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">GRUB_CMDLINE_LINUX</span>=<span class="string">"elevator=noop"</span></div></pre></td></tr></table></figure></p>
<p>Run <code>update-grub2</code> command to apply the changed configurations:<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span>-grub2</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;What-Is-I-O-Scheduler&quot;&gt;&lt;a href=&quot;#What-Is-I-O-Scheduler&quot; class=&quot;headerlink&quot; title=&quot;What Is I/O Scheduler&quot;&gt;&lt;/a&gt;What Is I/O Scheduler&lt;/
    
    </summary>
    
    
      <category term="linux" scheme="http://www.orctom.com/tags/linux/"/>
    
      <category term="io" scheme="http://www.orctom.com/tags/io/"/>
    
  </entry>
  
  <entry>
    <title>Java Locks and Concurrency</title>
    <link href="http://www.orctom.com/2017/04/21/java-locks-and-concurrency/"/>
    <id>http://www.orctom.com/2017/04/21/java-locks-and-concurrency/</id>
    <published>2017-04-21T08:08:03.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a>Locks</h2><h3 id="Implicit-Locks"><a href="#Implicit-Locks" class="headerlink" title="Implicit Locks"></a>Implicit Locks</h3><p>Or synchronized methods and synchronized blocks.</p>
<p>Each object in java has a intrinsic lock associated with it.</p>
<p>Synchronized methods use the lock of method owner object; Synchronized blocks, if you don’t pass in any object in, same as sychronized methods, otherwise, it use the object you passed in as the lock.</p>
<p>Synchronized methods and blocks are reentrant.</p>
<p><strong>Drawbacks</strong></p>
<ul>
<li>fairness lock</li>
<li>read / write lock</li>
</ul>
<h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/lock.png" alt="Lock"></p>
<p>Here indicates its implementation <code>ReentrantLock</code>. Use <code>lock()</code> to aquire the lock and <code>unlock()</code> to release it. And make sure applying the try-finally pattern with it, in case of exceptions.</p>
<h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h3><p>Or its implementation <code>ReentrantReadWriteLock</code>, which defined a pair of locks for read and write access. It allows multiply read threads holding the read lock when no write lock been hold. It would improve the throughput for circonstances that reads are more frequent than writes.</p>
<h3 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h3><p>Also provide read/write locks, but is <strong>NOT reentrant</strong>.</p>
<p>The locking methods of a StampedLock return a stamp represented (a long value), which can be used to release a lock or to check if the lock is still valid.</p>
<ul>
<li><code>readLock()</code>: exclusive blocking</li>
<li><code>writeLock()</code>: non-exclusive blocking</li>
<li><code>tryOptimisticRead()</code>: returns a non-zero stamp only if the lock is not currently held in write mode, and you have to use <code>validate(stamp)</code> (might be repeatablly) to test if any write lock has break it</li>
<li><code>tryConvertToWriteLock()</code>: try to convert a read lock to write lock</li>
</ul>
<h3 id="LockSupport"><a href="#LockSupport" class="headerlink" title="LockSupport"></a>LockSupport</h3><p>At most one permit, but permit can prepared before acquiring.</p>
<ul>
<li><code>park()</code> to block the thread waiting for a permit</li>
<li><p><code>unpark(thread)</code> to add a permit (not accumulate) to the thread</p>
</li>
<li><p>thread.interrupt() can also unpark the thread, but won’t throw InterrupptedException</p>
</li>
<li>park will return if the caller’s thread was interrupted</li>
<li>unpark can be invoked before park</li>
<li>parking methods may return spuriously, so it is important to call park() in a loop that can repark the thread if it should not have resumed</li>
<li>the blocker object is for diagnose purpose</li>
</ul>
<h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/java-concurrent-collections.png" alt="Concurrent Collections"></p>
<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>A latch that multiply threads waiting for, will be notified only <strong>once</strong> when the counter reaches zero.</p>
<h3 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h3><p>Repeatable <code>CountDownLatch</code>.</p>
<h3 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h3><p>Only n processes can access a certain resource at a given time.</p>
<ul>
<li><code>acquire()</code> will block until permits are available</li>
<li><code>release()</code> to release a permit</li>
<li><code>acquireInterruptibly()</code> acquire a resource, reattempting if it is interrupted</li>
<li><code>tryAcquire()</code> can limit how long we will wait for a permit</li>
</ul>
<p>Some tricks:</p>
<ul>
<li>Release doesn’t have to be called by the same thread as acquire, or the permit is <strong>accumulate</strong></li>
<li>Increase the number of permits at runtime (<code>release()</code> will always increase the number of permits)</li>
</ul>
<h3 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h3><p><strong>GC-less</strong> exchange data between only <strong>two</strong> threads.</p>
<h3 id="Atomic"><a href="#Atomic" class="headerlink" title="Atomic"></a>Atomic</h3><p>Atomic classes utlize CAS (compare-and-swap), which is directly supported by CPUs, so it’s much faster than synchronized and locks.</p>
<ul>
<li><code>AtomicBoolean</code></li>
<li><code>AtomicInteger</code></li>
<li><code>AtomicLong</code></li>
<li><code>AtomicReference</code></li>
<li><code>LongAdder</code>: preferable if more write threads than read threads, but take more memory</li>
<li><code>LongAccumulator</code>: generalized version of LongAdder, use <code>LongBinaryOperator</code> as operations</li>
</ul>
<h3 id="Blocking-Queues"><a href="#Blocking-Queues" class="headerlink" title="Blocking Queues"></a>Blocking Queues</h3><h4 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a><code>ArrayBlockingQueue</code></h4><ul>
<li>fixed size</li>
<li>array-based</li>
<li>best performance</li>
<li>single-lock double condition algorithm</li>
</ul>
<h4 id="LinkedBlockingQueue-LinkedBlockingDeque"><a href="#LinkedBlockingQueue-LinkedBlockingDeque" class="headerlink" title="LinkedBlockingQueue / LinkedBlockingDeque"></a><code>LinkedBlockingQueue</code> / <code>LinkedBlockingDeque</code></h4><ul>
<li>linked-list based</li>
<li>2 locks 2 conditions</li>
</ul>
<h4 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a><code>SynchronousQueue</code></h4><ul>
<li>zero capacity</li>
<li>the thread inserting data will block until there is a thread to remove that data or vice-versa</li>
<li>does not permit null elements</li>
</ul>
<h4 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a><code>DelayQueue</code></h4><ul>
<li>blocks the elements internally until a certain delay has expired</li>
<li>elements must implement <code>java.util.concurrent.Delayed</code></li>
</ul>
<h4 id="LinkedTransferQueue"><a href="#LinkedTransferQueue" class="headerlink" title="LinkedTransferQueue"></a><code>LinkedTransferQueue</code></h4><ul>
<li>waits for consumer to consume the element (message passing need to be guaranteed)</li>
</ul>
<h4 id="PriorityBlockingQueue"><a href="#PriorityBlockingQueue" class="headerlink" title="PriorityBlockingQueue"></a><code>PriorityBlockingQueue</code></h4><ul>
<li>concurrent version of <code>PriorityQueue</code></li>
</ul>
<h3 id="Thread-Pools"><a href="#Thread-Pools" class="headerlink" title="Thread Pools"></a>Thread Pools</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/java-concurrent-executors.png" alt="Executors"></p>
<ul>
<li><code>newCachedThreadPool()</code>: reuses threads when possible, creates new ones as needed with no configured limit</li>
<li><code>newFixedThreadPool(int nThreads)</code>: uses only up to the number of threads specified</li>
<li><code>newScheduledThreadPool(int corePoolSize)</code>: schedules threads with delayed execution, returns <code>ScheduledExecutorService</code> with:<ul>
<li><code>schedule(Runnable command, long delay, TimeUnit unit)</code></li>
<li><code>scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit)</code></li>
<li><code>scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit)</code></li>
</ul>
</li>
<li><code>newSingleThreadExecutor()</code> and <code>newSingleThreadScheduledExecutor()</code>: a single thread/task is executing at a time.</li>
</ul>
<h3 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/java-concurrent-future.png" alt="Future"></p>
<h4 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h4><p>Some methods</p>
<table>
<thead>
<tr>
<th>method</th>
<th>parameter</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>supplyAsync</td>
<td>Supplier&lt;U&gt; -&gt; U</td>
<td>apply a function to the result</td>
</tr>
<tr>
<td>thenApply</td>
<td>T -&gt; U</td>
<td>apply a function to the result</td>
</tr>
<tr>
<td>thenAccept</td>
<td>T -&gt; void</td>
<td>like <code>thenApplay</code> but with no return value</td>
</tr>
<tr>
<td>handle</td>
<td>(T, Throwable) -&gt; U</td>
<td>process the error result</td>
</tr>
<tr>
<td>whenComplete</td>
<td>(T, Throwable) -&gt; void</td>
<td>like <code>handle</code> but with not return value</td>
</tr>
<tr>
<td>thenCompose</td>
<td>T -&gt; CompletableFuture<u></u></td>
<td>invoke the function on the result and esecute returned future</td>
</tr>
<tr>
<td>thenRun</td>
<td>Runnable</td>
<td>execute the runnable</td>
</tr>
</tbody>
</table>
<h3 id="ForkJoin"><a href="#ForkJoin" class="headerlink" title="ForkJoin"></a>ForkJoin</h3><p>The fork/join framework is to parallel processing tasks by trying to use all available processor cores.<br>Tasks are stored in a deque.</p>
<p>It can speed up processing of large tasks, but should follow these guidelines:</p>
<ul>
<li>Use as few thread pools as possible</li>
<li>Use the default common thread pool</li>
<li>Use a reasonable threshold</li>
<li>Avoid any blocking in your ForkJoingTasks</li>
</ul>
<h4 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h4><p>The ForkJoinPool which implemented <code>ExecutorService</code>, is the heart of the framework.</p>
<h4 id="Work-Stealing-Algorithm"><a href="#Work-Stealing-Algorithm" class="headerlink" title="Work Stealing Algorithm"></a>Work Stealing Algorithm</h4><p>Free threads try to “steal” work from deques of busy threads from tail.</p>
<p>By default, a worker thread gets tasks from the head of its own deque. When it is empty, the thread takes a task from the tail of the deque of another busy thread or from the global entry queue</p>
<h4 id="ForkJoinTask"><a href="#ForkJoinTask" class="headerlink" title="ForkJoinTask"></a>ForkJoinTask<v></v></h4><p>The base type for tasks executed inside ForkJoinPool.<br>Your task class should extend either <code>RecursiveAction</code> for void tasks, or <code>RecursiveTask&lt;V&gt;</code> for tasks that return a value.</p>
<h2 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h2><p>Or <code>AbstractQueuedSynchronizer</code>.<br>It provides a framework for implementing blocking locks and related synchronizers like semaphores, by using a CLH derived queue, where each node represent a thread, consists of the following properties:</p>
<table>
<thead>
<tr>
<th>properties</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>prev:Node</td>
<td>previous node</td>
</tr>
<tr>
<td>next:Node</td>
<td>next node</td>
</tr>
<tr>
<td>thread:Thread</td>
<td>the thread that enqueued this node</td>
</tr>
<tr>
<td>nextWaiter:Node</td>
<td>Link to next node waiting on condition, or the special value SHARED</td>
</tr>
<tr>
<td>waitStatus:int</td>
<td>see bellow</td>
</tr>
</tbody>
</table>
<p><strong>waitStatus</strong></p>
<ul>
<li>0: new node or to be updated, or releasing</li>
<li>CANCELLED = 1: been cancelled due to timeout or interrupt, will be removed from the queue</li>
<li>SIGNAL = -1: the successor of this node is (or will soon be) blocked (via park), so the current node must unpark its successor when it releases or cancels</li>
<li>CONDITION = -2: on a condition queue, will not be used as a sync queue node until transferred (waitState -&gt; 0)</li>
<li>PROPAGATE = -3: a releaseShared should be propagated to other nodes. in shared mode, the head node could be in this state</li>
</ul>
<h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/aqs.png" alt="Classes"></p>
<p>To implement your own synchronizer, you would focus on the following methods:</p>
<ul>
<li>isHeldExclusively()</li>
<li>tryAcquire(int)</li>
<li>tryRelease(int)</li>
<li>tryAcquireShared(int)</li>
<li>tryReleaseShared(int)</li>
</ul>
<h3 id="Exclusive-Acquire"><a href="#Exclusive-Acquire" class="headerlink" title="Exclusive Acquire"></a>Exclusive Acquire</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/aqs-acquire-exclusive.png" alt="Exclusive Acquire"></p>
<h3 id="Release"><a href="#Release" class="headerlink" title="Release"></a>Release</h3><p><img src="https://raw.githubusercontent.com/orctom/images/master/java/aqs-release.png" alt="Release"></p>
<h2 id="Deadlocks-Prevention"><a href="#Deadlocks-Prevention" class="headerlink" title="Deadlocks Prevention"></a>Deadlocks Prevention</h2><ul>
<li>acquire multiple locks in a consistent order</li>
<li>don’t execute foreign code while holding a lock</li>
<li>use interruptible locks</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.javacodegeeks.com/2011/09/java-concurrency-tutorial.html" target="_blank" rel="external">https://www.javacodegeeks.com/2011/09/java-concurrency-tutorial.html</a></li>
<li><a href="http://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/" target="_blank" rel="external">http://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/</a></li>
<li><a href="http://www.javarticles.com/2012/10/abstractqueuedsynchronizer-aqs.html" target="_blank" rel="external">http://www.javarticles.com/2012/10/abstractqueuedsynchronizer-aqs.html</a></li>
<li><a href="https://www.ibm.com/developerworks/java/library/j-jtp05236/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/java/library/j-jtp05236/index.html</a></li>
<li><a href="http://gee.cs.oswego.edu/dl/papers/fj.pdf" target="_blank" rel="external">http://gee.cs.oswego.edu/dl/papers/fj.pdf</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Locks&quot;&gt;&lt;a href=&quot;#Locks&quot; class=&quot;headerlink&quot; title=&quot;Locks&quot;&gt;&lt;/a&gt;Locks&lt;/h2&gt;&lt;h3 id=&quot;Implicit-Locks&quot;&gt;&lt;a href=&quot;#Implicit-Locks&quot; class=&quot;head
    
    </summary>
    
    
      <category term="java" scheme="http://www.orctom.com/tags/java/"/>
    
      <category term="lock" scheme="http://www.orctom.com/tags/lock/"/>
    
      <category term="concurrency" scheme="http://www.orctom.com/tags/concurrency/"/>
    
  </entry>
  
  <entry>
    <title>JVM Options</title>
    <link href="http://www.orctom.com/2017/04/20/jvm-options/"/>
    <id>http://www.orctom.com/2017/04/20/jvm-options/</id>
    <published>2017-04-20T06:00:28.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/orctom/images/master/java/memory.jpg" alt="Overview"></p>
<h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><h3 id="Sizing"><a href="#Sizing" class="headerlink" title="Sizing"></a>Sizing</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-Xms</code></td>
<td>min heap size</td>
<td>-Xms8G</td>
</tr>
<tr>
<td><code>-Xmx</code></td>
<td>max heap size</td>
<td>-Xmx8G</td>
</tr>
<tr>
<td><code>-Xmn</code></td>
<td>min and max young size</td>
<td>-Xmn2G</td>
</tr>
<tr>
<td><code>-Xss</code></td>
<td>thread stack size, equivalent to <code>-XX:ThreadStackSize</code></td>
<td>-Xss1M</td>
</tr>
<tr>
<td><code>–XX:NewRatio</code></td>
<td>young size = <code>heap/(NewRatio + 1)</code>, or <code>NewRatio = old / young</code></td>
<td>default: –XX:NewRatio=2</td>
</tr>
<tr>
<td><code>-XX:NewSize</code></td>
<td>min young size</td>
<td>-XX:NewSize=3G</td>
</tr>
<tr>
<td><code>-XX:MaxNewSize</code></td>
<td>max young size</td>
<td>-XX:MaxNewSize=3G</td>
</tr>
<tr>
<td><code>-XX:SurvivorRatio</code></td>
<td>each survivor size = <code>young/(SurvivorRatio + 2)</code>, or <code>SurvivorRatio = eden / each survivor</code></td>
<td>Default: -XX:SurvivorRatio=8</td>
</tr>
<tr>
<td><code>-XX:PermSize</code></td>
<td>min PermGen size, Java &lt; 8</td>
<td>-XX:PermSize=512M</td>
</tr>
<tr>
<td><code>-XX:MaxPermSize</code></td>
<td>max PermGen size, Java &lt; 8</td>
<td>-XX:PermSize=512M</td>
</tr>
<tr>
<td><code>-XX:MaxMetaspaceSize</code></td>
<td>max metaspace size, Java &gt;= 8</td>
<td>-XX:MaxMetaspaceSize=1G</td>
</tr>
<tr>
<td><code>-XX:ThreadStackSize</code></td>
<td>thread stack size,  equivalent to <code>-Xss</code></td>
<td>-XX:ThreadStackSize=1M</td>
</tr>
</tbody>
</table>
<p><strong>Notice</strong></p>
<ul>
<li>Set <code>-Xms</code> and <code>-Xmx</code> the same value to avoid heap resizing in production</li>
</ul>
<h3 id="Performance-Options"><a href="#Performance-Options" class="headerlink" title="Performance Options"></a>Performance Options</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-XX:+UseLargePages</td>
<td>enable use large pages</td>
</tr>
<tr>
<td>-XX:LargePageSizeInBytes</td>
<td>large page size</td>
</tr>
</tbody>
</table>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="Print-All-Options"><a href="#Print-All-Options" class="headerlink" title="Print All Options"></a>Print All Options</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">java</span> <span class="selector-tag">-server</span> <span class="selector-tag">-XX</span><span class="selector-pseudo">:+AggressiveOpts</span> <span class="selector-tag">-XX</span><span class="selector-pseudo">:+UnlockDiagnosticVMOptions</span> <span class="selector-tag">-XX</span><span class="selector-pseudo">:+UnlockExperimentalVMOptions</span> <span class="selector-tag">-XX</span><span class="selector-pseudo">:+PrintFlagsFinal</span> <span class="selector-tag">-version</span></div></pre></td></tr></table></figure>
<h4 id="Enable-GC-Logs"><a href="#Enable-GC-Logs" class="headerlink" title="Enable GC Logs"></a>Enable GC Logs</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-<span class="ruby"><span class="symbol">verbose:</span>gc </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintGCApplicationStoppedTime </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintGCDateStamps </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintGCDetails </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintGCTimeStamps </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintHeapAtGC </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+PrintTenuringDistribution </span></div><div class="line">-<span class="ruby"><span class="symbol">Xloggc:</span>../logs/gc-<span class="string">`date +%F_%H-%M-%S`</span>.log </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>+UseGCLogFileRotation </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>NumberOfGCLogFiles=<span class="number">20</span> </span></div><div class="line">-<span class="ruby"><span class="symbol">XX:</span>GCLogFileSize=<span class="number">200</span>M</span></div></pre></td></tr></table></figure>
<h4 id="Alter-DNS-Cache"><a href="#Alter-DNS-Cache" class="headerlink" title="Alter DNS Cache"></a>Alter DNS Cache</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-Dsun<span class="selector-class">.net</span><span class="selector-class">.inetaddr</span><span class="selector-class">.ttl</span>=&lt;TTL <span class="keyword">in</span> seconds&gt;</div></pre></td></tr></table></figure>
<h4 id="Do-Not-Wait-Antropy-For-SecurityRandom"><a href="#Do-Not-Wait-Antropy-For-SecurityRandom" class="headerlink" title="Do Not Wait Antropy For SecurityRandom"></a>Do Not Wait Antropy For SecurityRandom</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-Djava<span class="selector-class">.security</span><span class="selector-class">.egd</span>=file:/dev/./urandom</div></pre></td></tr></table></figure>
<h4 id="Dump-on-OOM"><a href="#Dump-on-OOM" class="headerlink" title="Dump on OOM"></a>Dump on OOM</h4><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">-XX:</span>+HeapDumpOnOutOfMemoryError </div><div class="line"><span class="symbol">-XX:</span>HeapDumpPath=../logs/dump-`date +<span class="variable">%F_%</span>H-<span class="variable">%M-%</span>S`.hprof</div></pre></td></tr></table></figure>
<h4 id="Script-on-OOM"><a href="#Script-on-OOM" class="headerlink" title="Script on OOM"></a>Script on OOM</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-XX:OnOutOfMemoryError=<span class="string">"/path/to/script.sh</span></div></pre></td></tr></table></figure>
<h4 id="Enable-JMX"><a href="#Enable-JMX" class="headerlink" title="Enable JMX"></a>Enable JMX</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-Djava<span class="selector-class">.rmi</span><span class="selector-class">.server</span><span class="selector-class">.hostname</span>=&lt;external IP&gt;</div><div class="line">-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.port</span>=&lt;port&gt; </div><div class="line">-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.authenticate</span>=false </div><div class="line">-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.ssl</span>=false</div></pre></td></tr></table></figure>
<h2 id="Carbage-Collector"><a href="#Carbage-Collector" class="headerlink" title="Carbage Collector"></a>Carbage Collector</h2><h3 id="Young-Generation-Collector"><a href="#Young-Generation-Collector" class="headerlink" title="Young Generation Collector"></a>Young Generation Collector</h3><h4 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h4><p>Uses one thread to copy surviving objects from Eden to Survivor spaces and between Survivor spaces.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseSerialGC</span></div></pre></td></tr></table></figure></p>
<h4 id="PS-Scavenge"><a href="#PS-Scavenge" class="headerlink" title="PS Scavenge"></a>PS Scavenge</h4><p>Like the Copy collector, but uses multiple threads. (With PS Old Collector)<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseParallelGC</span></div></pre></td></tr></table></figure></p>
<h4 id="ParNew"><a href="#ParNew" class="headerlink" title="ParNew"></a>ParNew</h4><p>Like the Copy collector, but uses multiple threads. (With Concurrent Old Collector)<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseParNewGC</span></div></pre></td></tr></table></figure></p>
<h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><p>Old is also <code>G1</code>.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseG1GC</span></div></pre></td></tr></table></figure></p>
<h3 id="Old-Generation-Collector"><a href="#Old-Generation-Collector" class="headerlink" title="Old Generation Collector"></a>Old Generation Collector</h3><h4 id="MarkSweepCompact"><a href="#MarkSweepCompact" class="headerlink" title="MarkSweepCompact"></a>MarkSweepCompact</h4><p>The serial mark-sweep collector, uses one thread full mark-sweep garbage collection algorithm, with optional compaction.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseSerialGC</span></div></pre></td></tr></table></figure></p>
<h4 id="PS-MarkSweep"><a href="#PS-MarkSweep" class="headerlink" title="PS MarkSweep"></a>PS MarkSweep</h4><p>The parallel scavenge mark-sweep collector, multiple threads version of <code>MarkSweepCompact</code>.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseParallelOldGC</span></div></pre></td></tr></table></figure></p>
<h4 id="ConcurrentMarkSweep"><a href="#ConcurrentMarkSweep" class="headerlink" title="ConcurrentMarkSweep"></a>ConcurrentMarkSweep</h4><p>The <code>CMS</code> collector.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseConcMarkSweepGC</span></div></pre></td></tr></table></figure></p>
<h4 id="G1-Mixed"><a href="#G1-Mixed" class="headerlink" title="G1 Mixed"></a>G1 Mixed</h4><p>The <code>G1</code> collector.<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-XX</span><span class="selector-pseudo">:+UseG1GC</span></div></pre></td></tr></table></figure></p>
<h3 id="Combinations"><a href="#Combinations" class="headerlink" title="Combinations"></a>Combinations</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Young</th>
<th>Old</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-XX:+UseSerialGC</code></td>
<td><code>Copy</code></td>
<td><code>MarkSweepCompact</code></td>
</tr>
<tr>
<td><code>-XX:+UseG1GC</code></td>
<td><code>G1 Young</code></td>
<td><code>G1 Mixed</code></td>
</tr>
<tr>
<td><code>-XX:+UseParallelGC</code></td>
<td><code>PS Scavenge</code></td>
<td><code>PS MarkSweep</code></td>
</tr>
<tr>
<td><code>-XX:+UseConcMarkSweepGC</code></td>
<td><code>ParNew</code></td>
<td><code>MarkSweepCompact</code></td>
</tr>
</tbody>
</table>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><h4 id="Parallel-Collector"><a href="#Parallel-Collector" class="headerlink" title="Parallel Collector"></a>Parallel Collector</h4><p>For backend application, for its high throughput.<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-<span class="keyword">server</span> -Xms4G -Xmx4G</div></pre></td></tr></table></figure></p>
<h4 id="CMS-Collector"><a href="#CMS-Collector" class="headerlink" title="CMS Collector"></a>CMS Collector</h4><p>For frontend application, for its low latency.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-server -Xms6G -Xmx6G -Xmn2G -<span class="string">XX:</span>SurvivorRatio=<span class="number">2</span> </div><div class="line">-<span class="string">XX:</span>+UseConcMarkSweepGC -<span class="string">XX:</span>+CMSParallelRemarkEnabled -<span class="string">XX:</span>+UseCMSInitiatingOccupancyOnly </div><div class="line">-<span class="string">XX:</span>+ScavengeBeforeFullGC -<span class="string">XX:</span>+CMSScavengeBeforeRemark -<span class="string">XX:</span>CMSInitiatingOccupancyFraction=<span class="number">65</span> </div><div class="line">-<span class="string">XX:</span>+ParallelRefProcEnabled -<span class="string">XX:</span>+AlwaysPreTouch</div></pre></td></tr></table></figure></p>
<h4 id="Phases"><a href="#Phases" class="headerlink" title="Phases"></a>Phases</h4><ul>
<li>Initial Mark: <strong>stop-the-world</strong>, identify direct reachable objects from GC roots</li>
<li>Concurrent Mark: mark the objects reachable from initially marked</li>
<li>Precleaning: mark new objects as live/dead in the OOP table</li>
<li>Remark: <strong>stop-the-world</strong>, retrace from GC roots and remark objects as live/dead in the OOP table</li>
<li>Concurent Sweep: mark dead objects as free space</li>
<li>Reset: reset the state to get ready for next collection</li>
</ul>
<p>OOP = Ordinary Object Pointer</p>
<h4 id="G1-Collector"><a href="#G1-Collector" class="headerlink" title="G1 Collector"></a>G1 Collector</h4><p>For applications that use big memorys (at least 8G), or you want to play it safe.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-server -Xms12G -Xmx12G -<span class="string">XX:</span>+UseG1GC -<span class="string">XX:</span>MaxGCPauseMillis=<span class="number">100</span></div></pre></td></tr></table></figure></p>
<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><h3 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h3><h4 id="Dump-The-Heap"><a href="#Dump-The-Heap" class="headerlink" title="Dump The Heap"></a>Dump The Heap</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -dump:format=<span class="selector-tag">b</span>,file=dump<span class="selector-class">.hprof</span> &lt;pid&gt;</div></pre></td></tr></table></figure>
<h4 id="Dump-The-Heap-Live-Only"><a href="#Dump-The-Heap-Live-Only" class="headerlink" title="Dump The Heap, Live Only"></a>Dump The Heap, Live Only</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -dump:live,format=<span class="selector-tag">b</span>,file=dump<span class="selector-class">.hprof</span> &lt;pid&gt;</div></pre></td></tr></table></figure>
<h4 id="Print-Distribution"><a href="#Print-Distribution" class="headerlink" title="Print Distribution"></a>Print Distribution</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -heap <span class="tag">&lt;<span class="name">pid</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h3><h4 id="Loaded-Unloaded-Classes-Info"><a href="#Loaded-Unloaded-Classes-Info" class="headerlink" title="Loaded/Unloaded Classes Info"></a>Loaded/Unloaded Classes Info</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat –<span class="class"><span class="keyword">class</span> [-<span class="title">h15</span>] &lt;pid&gt; [<span class="title">interval</span>] [<span class="title">count</span>]</span></div></pre></td></tr></table></figure>
<h4 id="Compiler-Info"><a href="#Compiler-Info" class="headerlink" title="Compiler Info"></a>Compiler Info</h4><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -compiler <span class="string">[-h15]</span> &lt;pid&gt; <span class="string">[interval]</span> <span class="string">[count]</span></div></pre></td></tr></table></figure>
<h4 id="Capacities-KB-and-GC-Info"><a href="#Capacities-KB-and-GC-Info" class="headerlink" title="Capacities (KB) and GC Info"></a>Capacities (KB) and GC Info</h4><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -gc <span class="string">[-h15]</span> &lt;pid&gt; <span class="string">[interval]</span> <span class="string">[count]</span></div></pre></td></tr></table></figure>
<h4 id="Capacities-Ratio-and-GC-Info"><a href="#Capacities-Ratio-and-GC-Info" class="headerlink" title="Capacities (Ratio) and GC Info"></a>Capacities (Ratio) and GC Info</h4><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -gcutil <span class="string">[-h15]</span> &lt;pid&gt; <span class="string">[interval]</span> <span class="string">[count]</span></div></pre></td></tr></table></figure>
<h4 id="Capacities-KB-Info"><a href="#Capacities-KB-Info" class="headerlink" title="Capacities (KB) Info"></a>Capacities (KB) Info</h4><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -gccapacity <span class="string">[-h15]</span> &lt;pid&gt; <span class="string">[interval]</span> <span class="string">[count]</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>S0C</td>
<td><code>Survivor0</code> space capacity (KB)</td>
</tr>
<tr>
<td>S1C</td>
<td><code>Survivor1</code> space capacity (KB)</td>
</tr>
<tr>
<td>S0U</td>
<td><code>Survivor0</code> space utilization (KB)</td>
</tr>
<tr>
<td>S1U</td>
<td><code>Survivor1</code> space utilization (KB)</td>
</tr>
<tr>
<td>EC</td>
<td><code>Eden</code> space capacity (KB)</td>
</tr>
<tr>
<td>EU</td>
<td><code>Eden</code> space utilization (KB)</td>
</tr>
<tr>
<td>OC</td>
<td><code>Old</code> space capacity (KB)</td>
</tr>
<tr>
<td>OU</td>
<td><code>Old</code> space utilization (KB)</td>
</tr>
<tr>
<td>PC</td>
<td><code>Permanent</code> space capacity  (KB)</td>
</tr>
<tr>
<td>PU</td>
<td><code>Permanent</code> space utilization (KB)</td>
</tr>
<tr>
<td>YGC</td>
<td>number of <code>Yong GC</code> events</td>
</tr>
<tr>
<td>YGCT</td>
<td>used time for <code>Yong GC</code></td>
</tr>
<tr>
<td>FGC</td>
<td>number of <code>Full GC</code> events</td>
</tr>
<tr>
<td>FGCT</td>
<td>used time for <code>Full GC</code></td>
</tr>
<tr>
<td>GCT</td>
<td>total used time for <code>GC</code></td>
</tr>
<tr>
<td>MC</td>
<td>Metaspace capacity (KB)</td>
</tr>
<tr>
<td>MU</td>
<td>Metacspace utilization (KB)</td>
</tr>
<tr>
<td>CCSC</td>
<td>Compressed class space capacity (KB)</td>
</tr>
<tr>
<td>CCSU</td>
<td>Compressed class space used (KB)</td>
</tr>
<tr>
<td>NGCMN</td>
<td><code>Young</code> space min capacity (KB)</td>
</tr>
<tr>
<td>NGCMX</td>
<td><code>Young</code> space max capacity (KB)</td>
</tr>
<tr>
<td>NGC</td>
<td><code>Young</code> space current capacity (KB)</td>
</tr>
<tr>
<td>OGCMN</td>
<td><code>Old</code> space min capacity (KB)</td>
</tr>
<tr>
<td>OGCMX</td>
<td><code>Old</code> space max capacity (KB)</td>
</tr>
<tr>
<td>OGC</td>
<td><code>Old</code> space current capacity (KB)</td>
</tr>
</tbody>
</table>
<h3 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h3><p>Print threads information<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstack <span class="tag">&lt;<span class="name">pid</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h3><p>Check the option value of a running JVM<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jinfo -flag <span class="tag">&lt;<span class="name">option</span>&gt;</span> <span class="tag">&lt;<span class="name">pid</span>&gt;</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/orctom/images/master/java/memory.jpg&quot; alt=&quot;Overview&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Options&quot;&gt;&lt;a href=&quot;#Options&quot;
    
    </summary>
    
    
      <category term="java" scheme="http://www.orctom.com/tags/java/"/>
    
      <category term="jvm" scheme="http://www.orctom.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Java Memory Model</title>
    <link href="http://www.orctom.com/2017/04/20/jmm/"/>
    <id>http://www.orctom.com/2017/04/20/jmm/</id>
    <published>2017-04-20T04:43:13.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Areas"><a href="#Areas" class="headerlink" title="Areas"></a>Areas</h2><p><img src="http://i.imgur.com/KAvH1Rv.png" alt="memory model"></p>
<h3 id="Shared-Amoung-Threads"><a href="#Shared-Amoung-Threads" class="headerlink" title="Shared Amoung Threads"></a>Shared Amoung Threads</h3><h4 id="Method-Area"><a href="#Method-Area" class="headerlink" title="Method Area"></a>Method Area</h4><p>It stores following information, which are loaded by classloaders.</p>
<ul>
<li>class information</li>
<li>the bytecode of constructors and methods</li>
<li>a runtime constant pool per classloader</li>
</ul>
<table>
<thead>
<tr>
<th>JDK</th>
<th>Method Area</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oracle JDK &lt; 8</td>
<td>PermGen</td>
</tr>
<tr>
<td>Oracle JDK &gt;= 8</td>
<td>MetaSpace</td>
</tr>
</tbody>
</table>
<h4 id="Constant-Pool"><a href="#Constant-Pool" class="headerlink" title="Constant Pool"></a>Constant Pool</h4><p>A subpart of Method Area.</p>
<p>When a class, method or field is referred to, the JVM searches the actual address in the memory by using the runtime constant pool. It also contains constant values like <code>string litterals</code> or <code>constant primitives</code>.</p>
<h4 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h4><p>All class instances and arrays are allocated in the Heap.</p>
<h4 id="Direct-Native-Memory"><a href="#Direct-Native-Memory" class="headerlink" title="Direct Native Memory"></a>Direct Native Memory</h4><p>Can be allocated by <code>DirectByteBuffer</code>.</p>
<p>Direct Native Memory is allocated out side of Heap, while contains similar data as Heap, but you have to release the memory manually, since no GC for Direct Native Memory.</p>
<p>It’s been employed to reduce the copying between native memory and Heap. </p>
<h3 id="Not-Shared-Amoung-Threads"><a href="#Not-Shared-Amoung-Threads" class="headerlink" title="Not Shared Amoung Threads"></a>Not Shared Amoung Threads</h3><h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><p>Stack stores multiplies Frames, where a frame is a data structure that contains multiplies data that represents the state of the thread of <strong>current method</strong>.</p>
<h4 id="Native-Method-Stack"><a href="#Native-Method-Stack" class="headerlink" title="Native Method Stack"></a>Native Method Stack</h4><p>Stack for native methods, which is controlled by underlying OS.</p>
<h4 id="Program-Counter-Register"><a href="#Program-Counter-Register" class="headerlink" title="Program Counter Register"></a>Program Counter Register</h4><p>Each thread has its own PC Register, which is created the same time along with the thread.</p>
<p>It contains the JVM instruction (in Method Area) currently being executed.</p>
<h2 id="Reorderings"><a href="#Reorderings" class="headerlink" title="Reorderings"></a>Reorderings</h2><p>Reordering happens due to the out-of-order executions in CPUs and compilers, while JMM consists of the following rules to disallow reorderings.</p>
<h3 id="Lock-and-Unlock"><a href="#Lock-and-Unlock" class="headerlink" title="Lock and Unlock"></a>Lock and Unlock</h3><p>Including synchronized methods or blocks, </p>
<h3 id="Volatiles-and-Monitors"><a href="#Volatiles-and-Monitors" class="headerlink" title="Volatiles and Monitors"></a>Volatiles and Monitors</h3><pre>
  <table>
    <tr>
      <td align="center"><b>Can Reorder</b></td>
      <td colspan="3" rowspan="1" align="center"><em>2nd operation</em></td>
    </tr>
    <tr>
      <td><em>1st operation</em></td>
      <td>Normal Load / Normal Store</td>
      <td>Volatile Load / MonitorEnter</td>
      <td>Volatile Store / MonitorExit</td>
    </tr>
    <tr>
      <td>Normal Load / Normal Store</td>
      <td></td>
      <td></td>
      <td>No</td>
    </tr>
    <tr>
      <td>Volatile Load / MonitorEnter</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
    </tr>
    <tr>
      <td>Volatile store / MonitorExit</td>
      <td></td>
      <td>No</td>
      <td>No</td>
    </tr> 
  </table>
</pre>

<p>Where:</p>
<ul>
<li>Normal Loads are getfield, getstatic, array load of non-volatile fields.</li>
<li>Normal Stores are putfield, putstatic, array store of non-volatile fields</li>
<li>Volatile Loads are getfield, getstatic of volatile fields that are accessible by multiple threads</li>
<li>Volatile Stores are putfield, putstatic of volatile fields that are accessible by multiple threads</li>
<li>MonitorEnters (including entry to synchronized methods) are for lock objects accessible by multiple threads.</li>
<li>MonitorExits (including exit from synchronized methods) are for lock objects accessible by multiple threads.</li>
</ul>
<h3 id="Final-Fields"><a href="#Final-Fields" class="headerlink" title="Final Fields"></a>Final Fields</h3><p>The initialization of final fields in constructor are guarenteed to <code>happends-before</code> exiting the constructor.</p>
<h2 id="See-Also"><a href="#See-Also" class="headerlink" title="See Also"></a>See Also</h2><ul>
<li><a href="http://g.oswego.edu/dl/jmm/cookbook.html" target="_blank" rel="external">http://g.oswego.edu/dl/jmm/cookbook.html</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Areas&quot;&gt;&lt;a href=&quot;#Areas&quot; class=&quot;headerlink&quot; title=&quot;Areas&quot;&gt;&lt;/a&gt;Areas&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/KAvH1Rv.png&quot; alt=&quot;memory mode
    
    </summary>
    
    
      <category term="java" scheme="http://www.orctom.com/tags/java/"/>
    
      <category term="jvm" scheme="http://www.orctom.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Port Forwarding</title>
    <link href="http://www.orctom.com/2017/04/18/port-forwarding/"/>
    <id>http://www.orctom.com/2017/04/18/port-forwarding/</id>
    <published>2017-04-18T08:28:04.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>Say you can ssh to a remote linux box, while you want to access a blocked port on that remote box, you can make a stub, and forword the request to remote by:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ssh</span> <span class="selector-tag">-C</span> <span class="selector-tag">-f</span> <span class="selector-tag">-N</span> <span class="selector-tag">-g</span> <span class="selector-tag">-L</span> <span class="selector-tag">remote-port</span><span class="selector-pseudo">:localhost</span><span class="selector-pseudo">:port</span> <span class="selector-tag">user</span>@<span class="keyword">remote</span>-<span class="keyword">address</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Say you can ssh to a remote linux box, while you want to access a blocked port on that remote box, you can make a stub, and forword the r
    
    </summary>
    
    
      <category term="linux" scheme="http://www.orctom.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Ascii Art</title>
    <link href="http://www.orctom.com/2017/04/18/ascii-art/"/>
    <id>http://www.orctom.com/2017/04/18/ascii-art/</id>
    <published>2017-04-18T08:19:19.000Z</published>
    <updated>2017-05-24T14:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install figlet</div><div class="line">figlet <span class="string">"Shell Hacks"</span></div><div class="line"><span class="keyword">dir</span> /hao/softwares/figlet | xargs -<span class="keyword">n</span> 1 figlet Hao Chen -<span class="built_in">f</span></div></pre></td></tr></table></figure>
<p><a href="http://www.jave.de/figlet/figletfonts40.zip" target="_blank" rel="external">http://www.jave.de/figlet/figletfonts40.zip</a><br><a href="http://www-personal.umich.edu/~knassen/figfonts/other/other.html" target="_blank" rel="external">http://www-personal.umich.edu/~knassen/figfonts/other/other.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/di
    
    </summary>
    
    
      <category term="ascii" scheme="http://www.orctom.com/tags/ascii/"/>
    
  </entry>
  
</feed>
